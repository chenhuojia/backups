[ 2017-03-15T18:08:27+08:00 ] 119.129.74.254 /Admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000029s ]
INFO: [ app_init ] --END-- [ RunTime:0.043528s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049702s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049779s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000077s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000142s ]
NOTIC: [8] Undefined index: admin /web/www/blog/tp3/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 39 行.
NOTIC: [8] Undefined index: admin /web/www/blog/tp3/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 39 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.280631s ]
INFO: [ view_parse ] --END-- [ RunTime:0.280688s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.047268s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047337s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000466s ]
INFO: [ app_end ] --END-- [ RunTime:0.000492s ]

[ 2017-03-15T18:08:28+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000031s ]
INFO: [ app_init ] --END-- [ RunTime:0.046498s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.044624s ]
INFO: [ app_begin ] --END-- [ RunTime:0.044687s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000065s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000135s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.321732s ]
INFO: [ view_parse ] --END-- [ RunTime:0.321799s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000228s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000251s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.043475s ]
INFO: [ app_end ] --END-- [ RunTime:0.043552s ]

[ 2017-03-15T18:08:33+08:00 ] 119.129.74.254 /Admin.php/System/Verify.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.048472s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.044483s ]
INFO: [ app_begin ] --END-- [ RunTime:0.044541s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.044690s ]
INFO: [ app_end ] --END-- [ RunTime:0.044779s ]

[ 2017-03-15T18:08:33+08:00 ] 119.129.74.254 /Admin.php/System/index.js.map
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000018s ]
INFO: [ app_init ] --END-- [ RunTime:0.000317s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000483s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000539s ]
ERR: 非法操作:index.js.map

[ 2017-03-15T18:08:34+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.049457s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.044525s ]
INFO: [ app_begin ] --END-- [ RunTime:0.044587s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000073s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000157s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.311576s ]
INFO: [ view_parse ] --END-- [ RunTime:0.311628s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000152s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000175s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.047734s ]
INFO: [ app_end ] --END-- [ RunTime:0.047810s ]

[ 2017-03-15T18:08:38+08:00 ] 119.129.74.254 /Admin.php/System/Verify.html?0.09884833751442823
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.015594s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.056484s ]
INFO: [ app_begin ] --END-- [ RunTime:0.056553s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.043710s ]
INFO: [ app_end ] --END-- [ RunTime:0.043817s ]

[ 2017-03-15T18:08:39+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000015s ]
INFO: [ app_init ] --END-- [ RunTime:0.000452s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000425s ]
INFO: [ app_begin ] --END-- [ RunTime:0.045546s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000062s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000121s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.333334s ]
INFO: [ view_parse ] --END-- [ RunTime:0.333394s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000254s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000292s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.049555s ]
INFO: [ app_end ] --END-- [ RunTime:0.049625s ]

[ 2017-03-15T18:08:40+08:00 ] 119.129.74.254 /Admin.php/System/Verify.html?0.791168627434782
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000019s ]
INFO: [ app_init ] --END-- [ RunTime:0.045568s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000514s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000580s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000631s ]
INFO: [ app_end ] --END-- [ RunTime:0.045755s ]

[ 2017-03-15T18:08:41+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.047475s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.045544s ]
INFO: [ app_begin ] --END-- [ RunTime:0.045605s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000062s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000123s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.305800s ]
INFO: [ view_parse ] --END-- [ RunTime:0.305878s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000302s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000337s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.045712s ]
INFO: [ app_end ] --END-- [ RunTime:0.045776s ]

[ 2017-03-15T18:09:29+08:00 ] 119.129.74.254 /Admin.php/System/Verify.html?0.9816417713093974
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000013s ]
INFO: [ app_init ] --END-- [ RunTime:0.000328s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049678s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049773s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000576s ]
INFO: [ app_end ] --END-- [ RunTime:0.000659s ]

[ 2017-03-15T18:09:30+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000017s ]
INFO: [ app_init ] --END-- [ RunTime:0.000348s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049642s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049719s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000081s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000176s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.337807s ]
INFO: [ view_parse ] --END-- [ RunTime:0.337876s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.047365s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047445s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.046847s ]
INFO: [ app_end ] --END-- [ RunTime:0.046933s ]

[ 2017-03-15T18:09:31+08:00 ] 119.129.74.254 /Admin.php/System/Verify.html?0.37966177560865555
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.051552s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.045582s ]
INFO: [ app_begin ] --END-- [ RunTime:0.045658s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000668s ]
INFO: [ app_end ] --END-- [ RunTime:0.046902s ]

[ 2017-03-15T18:09:31+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000014s ]
INFO: [ app_init ] --END-- [ RunTime:0.000337s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.042760s ]
INFO: [ app_begin ] --END-- [ RunTime:0.042830s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000062s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000124s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.260154s ]
INFO: [ view_parse ] --END-- [ RunTime:0.260245s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000203s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000226s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000378s ]
INFO: [ app_end ] --END-- [ RunTime:0.046503s ]

[ 2017-03-15T18:09:32+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000020s ]
INFO: [ app_init ] --END-- [ RunTime:0.043085s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000454s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000506s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000061s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000120s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.323354s ]
INFO: [ view_parse ] --END-- [ RunTime:0.323414s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000228s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000250s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.030906s ]
INFO: [ app_end ] --END-- [ RunTime:0.030973s ]

[ 2017-03-15T18:09:38+08:00 ] 119.129.74.254 /Admin.php/System/Verify.html?0.20454903919915712
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000028s ]
INFO: [ app_init ] --END-- [ RunTime:0.047593s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000532s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000603s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.046761s ]
INFO: [ app_end ] --END-- [ RunTime:0.046861s ]

[ 2017-03-15T18:09:39+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000016s ]
INFO: [ app_init ] --END-- [ RunTime:0.000393s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000414s ]
INFO: [ app_begin ] --END-- [ RunTime:0.045511s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.046124s ]
INFO: [ template_filter ] --END-- [ RunTime:0.046231s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.293694s ]
INFO: [ view_parse ] --END-- [ RunTime:0.340809s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.044520s ]
INFO: [ view_filter ] --END-- [ RunTime:0.044585s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.034567s ]
INFO: [ app_end ] --END-- [ RunTime:0.034646s ]

[ 2017-03-15T18:09:43+08:00 ] 119.129.74.254 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000017s ]
INFO: [ app_init ] --END-- [ RunTime:0.000341s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000437s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000500s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000061s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000121s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.309689s ]
INFO: [ view_parse ] --END-- [ RunTime:0.309748s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000154s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000177s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.046575s ]
INFO: [ app_end ] --END-- [ RunTime:0.046631s ]

[ 2017-03-15T21:54:49+08:00 ] 183.232.228.22 /Admin.php
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.046545s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.052484s ]
INFO: [ app_begin ] --END-- [ RunTime:0.052556s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000077s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000151s ]
NOTIC: [8] Undefined index: admin /web/www/blog/tp3/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 39 行.
NOTIC: [8] Undefined index: admin /web/www/blog/tp3/Application/Runtime/Cache/Admin/b595b808c2ebeeeb0478ffc30bb4e87a.php 第 39 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.339925s ]
INFO: [ view_parse ] --END-- [ RunTime:0.430131s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000318s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000356s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.051706s ]
INFO: [ app_end ] --END-- [ RunTime:0.051779s ]

[ 2017-03-15T21:54:51+08:00 ] 183.232.228.22 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.043601s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000490s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000562s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000076s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000188s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.332013s ]
INFO: [ view_parse ] --END-- [ RunTime:0.332067s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.043855s ]
INFO: [ view_filter ] --END-- [ RunTime:0.043929s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.024612s ]
INFO: [ app_end ] --END-- [ RunTime:0.024685s ]

[ 2017-03-15T21:54:53+08:00 ] 183.232.228.22 /Admin.php/System/Verify.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000018s ]
INFO: [ app_init ] --END-- [ RunTime:0.000389s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000413s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000476s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.044812s ]
INFO: [ app_end ] --END-- [ RunTime:0.044911s ]

[ 2017-03-15T21:54:55+08:00 ] 183.232.228.22 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000019s ]
INFO: [ app_init ] --END-- [ RunTime:0.000329s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000357s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000410s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000065s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000137s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.327957s ]
INFO: [ view_parse ] --END-- [ RunTime:0.328031s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000205s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000254s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.031800s ]
INFO: [ app_end ] --END-- [ RunTime:0.031887s ]

[ 2017-03-15T21:55:06+08:00 ] 183.232.228.22 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.047515s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.045644s ]
INFO: [ app_begin ] --END-- [ RunTime:0.045725s ]
SQL: SHOW COLUMNS FROM `bk_admin` [ RunTime:0.0266s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: SELECT * FROM `bk_admin` WHERE `name` = 'root' LIMIT 1   [ RunTime:0.0591s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000051s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000129s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.205103s ]
INFO: [ view_parse ] --END-- [ RunTime:0.205145s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000190s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000223s ]

[ 2017-03-15T21:55:10+08:00 ] 183.232.228.22 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.052688s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049742s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049844s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000063s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000131s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.353569s ]
INFO: [ view_parse ] --END-- [ RunTime:0.353694s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000307s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000343s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.045657s ]
INFO: [ app_end ] --END-- [ RunTime:0.045719s ]

[ 2017-03-15T21:55:11+08:00 ] 183.232.228.22 /Admin.php/System/Verify.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000018s ]
INFO: [ app_init ] --END-- [ RunTime:0.000350s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000602s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000672s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.048794s ]
INFO: [ app_end ] --END-- [ RunTime:0.048900s ]

[ 2017-03-15T21:55:18+08:00 ] 183.232.228.22 /Admin.php/System/Login.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.046498s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.048698s ]
INFO: [ app_begin ] --END-- [ RunTime:0.048779s ]
SQL: SHOW COLUMNS FROM `bk_admin` [ RunTime:0.0249s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: SELECT * FROM `bk_admin` WHERE `name` = 'admin' LIMIT 1   [ RunTime:0.0247s ]
SQL: update bk_admin set last_login_time= '2017-03-15 21:55:17',login_num=login_num+1,login_ip='172.17.112.146' where id=1 [ RunTime:0.0585s ]

[ 2017-03-15T21:55:21+08:00 ] 183.232.228.22 /Admin.php/Index.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000017s ]
INFO: [ app_init ] --END-- [ RunTime:0.000359s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000513s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000570s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000088s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000186s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.394093s ]
INFO: [ view_parse ] --END-- [ RunTime:0.394178s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.041422s ]
INFO: [ view_filter ] --END-- [ RunTime:0.041511s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000664s ]
INFO: [ app_end ] --END-- [ RunTime:0.000700s ]

[ 2017-03-15T21:55:22+08:00 ] 183.232.228.22 /Admin.php/Index/welcome.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.035518s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049631s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049699s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000067s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000124s ]
NOTIC: [8] Undefined index: USERNAME /web/www/blog/tp3/Application/Runtime/Cache/Admin/69fa43b310489e974c292babf8eca7e7.php 第 108 行.
NOTIC: [8] Undefined index: PATH /web/www/blog/tp3/Application/Runtime/Cache/Admin/69fa43b310489e974c292babf8eca7e7.php 第 136 行.
NOTIC: [8] Undefined index: USERNAME /web/www/blog/tp3/Application/Runtime/Cache/Admin/69fa43b310489e974c292babf8eca7e7.php 第 196 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.414456s ]
INFO: [ view_parse ] --END-- [ RunTime:0.414522s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000295s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000334s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.043829s ]
INFO: [ app_end ] --END-- [ RunTime:0.043910s ]

[ 2017-03-15T21:55:54+08:00 ] 183.232.228.22 /Admin.php/Category/articleList.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000382s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000373s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000425s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0250s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0249s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_category` LIMIT 1   [ RunTime:0.0247s ]
SQL: SELECT * FROM `bk_category` ORDER BY sort desc LIMIT 0,10   [ RunTime:0.0248s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000068s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000128s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.427803s ]
INFO: [ view_parse ] --END-- [ RunTime:0.427879s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000237s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000260s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.046678s ]
INFO: [ app_end ] --END-- [ RunTime:0.046741s ]

[ 2017-03-15T21:55:55+08:00 ] 183.232.228.22 /Admin.php/Category/articleList.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.046515s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049531s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049609s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0262s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0261s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_category` LIMIT 1   [ RunTime:0.0258s ]
SQL: SELECT * FROM `bk_category` ORDER BY sort desc LIMIT 0,10   [ RunTime:0.0259s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000069s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000127s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.327449s ]
INFO: [ view_parse ] --END-- [ RunTime:0.327520s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.049334s ]
INFO: [ view_filter ] --END-- [ RunTime:0.049410s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.024738s ]
INFO: [ app_end ] --END-- [ RunTime:0.024827s ]

[ 2017-03-15T21:55:57+08:00 ] 183.232.228.22 /Admin.php/Blog/article.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.049556s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.043678s ]
INFO: [ app_begin ] --END-- [ RunTime:0.043743s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0251s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0248s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0248s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 0,10   [ RunTime:0.1690s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000097s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000182s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.405684s ]
INFO: [ view_parse ] --END-- [ RunTime:0.405774s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000291s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046393s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000663s ]
INFO: [ app_end ] --END-- [ RunTime:0.000750s ]

[ 2017-03-15T21:56:03+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.045572s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000613s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000691s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0252s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0249s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000126s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000226s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.278310s ]
INFO: [ view_parse ] --END-- [ RunTime:0.278375s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000191s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000224s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000660s ]
INFO: [ app_end ] --END-- [ RunTime:0.000743s ]

[ 2017-03-15T21:58:14+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.047591s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000470s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000525s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0249s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES (' ThinkPHP 之 手机端API开发','1','app接口开发','&lt;h3 id=&quot;articleHeader0&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.5em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;规划&lt;/h3&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;API请求的执行流程：&lt;/span&gt;&lt;/p&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;router：路由，把请求路由到controller&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;权限认证：&lt;/p&gt;&lt;/li&gt;&lt;ul style=&quot;list-style-type: square;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;登录验证&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;行为权限判断&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;模型拥有权限判断&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;请求被转发到控制器执行&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;返回数据结果&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;模型拥有权限判断 :&lt;/span&gt;&amp;nbsp;比如店长具有写店铺信息的权限：即“行为权限判断”，但是要判断他写入的对象是不是belong to 他，所以有了这个判断，应该很好理解吧&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;计划好上面的流程，所以我们可以想想TP要怎么做呢？&lt;/span&gt;&lt;/p&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;路由：Tp本身就有路由啦，直接拿来用，不多说了。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;请求被转发到控制器执行：这个也是由TP的路由自己有的，所以也没啥好多说的，主要还是控制器中间的逻辑&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;权限验证：this is a big question！既然router可以直接把请求转到控制器下，那么我们要怎么做权限验证呢？难道要在每个控制器里面写一遍吗？当然，其实我们有其他的解决方法：大家不知道有没有看到其实tp也支持apo面向切入的，在tp叫做&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;Behavior&lt;/span&gt;。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;articleHeader1&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.5em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;关于ThinkPHP基础&lt;/h3&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;下载thinkphp：&lt;a href=&quot;http://www.thinkphp.cn/down.html&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;http://www.thinkphp.cn/down.html&lt;/a&gt;&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;thinphp文档地址：&lt;a href=&quot;http://www.kancloud.cn/manual/thinkphp/1678&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;http://www.kancloud.cn/manual/thinkphp/1...&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;然后把它放到本地服务器下，我用的是MAMP，window系统建议使用xmapp&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;（如不会请自行百度，xmapp已经算傻瓜操作了，下载就能用，还附带mysql和phpmyadmin）&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;访问&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;http://localhost&lt;/code&gt;&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;就可以看到Application目录下面多了Home目录，以后我们主要在这下面进行开发。然后你需要做的是填写好数据库的信息，与数据建立连接&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 id=&quot;articleHeader2&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.5em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;建立Router&lt;/h3&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;在配置&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Home/Conf/config.php&lt;/code&gt;中开启路由，同时为了将路由单独分离出来，我们在这个文件夹下面单独建一个&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;router.php&lt;/code&gt;，并在&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Home/Conf/config.php&lt;/code&gt;这样写：&lt;/p&gt;&lt;pre class=&quot;hljs xml&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;lt;?phpreturn&amp;nbsp;array(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;#39;配置项&amp;#39;=&amp;gt;&amp;#39;配置值&amp;#39;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;URL_ROUTER_ON&amp;#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;=&amp;gt;&amp;nbsp;true,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;URL_ROUTE_RULES&amp;#39;=&amp;gt;&amp;nbsp;include_once&amp;nbsp;__DIR__.&amp;#39;/router.php&amp;#39;,
);&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;之后我们在router.php添加测试路由&lt;/p&gt;&lt;pre class=&quot;hljs xml&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;lt;?phpreturn&amp;nbsp;array(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;news/:id&amp;#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;Index/index&amp;#39;,
);&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;访问&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;http://localhost/news/1&lt;/code&gt;，之后我们发现&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;无法加载模块:News&lt;/code&gt;的错误提示，那是因为我们没有绑定默认模块，所以必须用&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;http://localhost/Home/news/1&lt;/code&gt;访问，或者在&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;index.php&lt;/code&gt;添加&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;define(&amp;#39;BIND_MODULE&amp;#39;,&amp;#39;Home&amp;#39;);&lt;/code&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;解决好上面问题，我们就能看主页了。&lt;/p&gt;&lt;h3 id=&quot;articleHeader3&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.5em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;设置权限验证类&lt;/h3&gt;&lt;h4 style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px; font-size: 1.25em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;建立数据库&lt;/h4&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;建立用户表&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;`users`&amp;nbsp;(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`id`&amp;nbsp;int(11)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;AUTO_INCREMENT,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`tel`&amp;nbsp;varchar(19)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;手机号&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`password`&amp;nbsp;char(32)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;密码&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`avatar`&amp;nbsp;varchar(500)&amp;nbsp;DEFAULT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;头像&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`nick`&amp;nbsp;varchar(45)&amp;nbsp;DEFAULT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;昵称&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY&amp;nbsp;(`id`)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&amp;nbsp;ENGINE=InnoDB&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=utf8;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;建立AccessToken表&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;`access_token`&amp;nbsp;(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`id`&amp;nbsp;int(11)&amp;nbsp;unsigned&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;AUTO_INCREMENT,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`token`&amp;nbsp;char(60)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;DEFAULT&amp;nbsp;&amp;#39;&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`uid`&amp;nbsp;int(11)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;用户id&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`failuretime`&amp;nbsp;int(11)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;失效时间&amp;nbsp;时间戳&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY&amp;nbsp;(`id`)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&amp;nbsp;ENGINE=InnoDB&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=utf8;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;建立角色组表&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;`role_group`&amp;nbsp;(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`id`&amp;nbsp;int(11)&amp;nbsp;unsigned&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;AUTO_INCREMENT,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`name`&amp;nbsp;varchar(20)&amp;nbsp;DEFAULT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;用户组名称&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`rules`&amp;nbsp;varchar(1000)&amp;nbsp;DEFAULT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;规则数组&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY&amp;nbsp;(`id`)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&amp;nbsp;ENGINE=InnoDB&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=utf8;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;建立规则表&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;`rule`&amp;nbsp;(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`id`&amp;nbsp;int(11)&amp;nbsp;unsigned&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;AUTO_INCREMENT,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`action`&amp;nbsp;varchar(20)&amp;nbsp;DEFAULT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;动作标识&amp;nbsp;唯一标识&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`name`&amp;nbsp;varchar(30)&amp;nbsp;DEFAULT&amp;nbsp;NULL&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;规则名称&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`condition`&amp;nbsp;varchar(300)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;DEFAULT&amp;nbsp;&amp;#39;&amp;#39;&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;条件&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`type`&amp;nbsp;int(1)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;DEFAULT&amp;nbsp;&amp;#39;0&amp;#39;&amp;nbsp;COMMENT&amp;nbsp;&amp;#39;\\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;0&amp;nbsp;-&amp;nbsp;member\\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;1&amp;nbsp;-&amp;nbsp;owner\\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2&amp;nbsp;-&amp;nbsp;&amp;nbsp;everyone&amp;nbsp;&amp;#39;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY&amp;nbsp;(`id`),&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;UNIQUE&amp;nbsp;KEY&amp;nbsp;`action`&amp;nbsp;(`action`)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&amp;nbsp;ENGINE=InnoDB&amp;nbsp;AUTO_INCREMENT=2&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=utf8;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;建立用户归属角色组表&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;`role_user_play`&amp;nbsp;(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`uid`&amp;nbsp;int(11)&amp;nbsp;NOT&amp;nbsp;NULL,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`rid`&amp;nbsp;int(11)&amp;nbsp;NOT&amp;nbsp;NULL,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY&amp;nbsp;(`uid`,`rid`)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&amp;nbsp;ENGINE=InnoDB&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=utf8;&lt;/pre&gt;&lt;h4 style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px; font-size: 1.25em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;编写权限验证类&lt;/h4&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;建立好以上表，下面我们来建立权限验证的类库扩展&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;在&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ThinkPHP/Libaray/Org/Util&lt;/code&gt;下建立&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Auth.class.php&lt;/code&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;代码如下&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;lt;?php/**
&amp;nbsp;*&amp;nbsp;Created&amp;nbsp;by&amp;nbsp;PhpStorm.
&amp;nbsp;*&amp;nbsp;User:&amp;nbsp;rojer
&amp;nbsp;*&amp;nbsp;Date:&amp;nbsp;16/3/30
&amp;nbsp;*&amp;nbsp;Time:&amp;nbsp;下午1:38
&amp;nbsp;*/namespace&amp;nbsp;Org\\Util;class&amp;nbsp;Auth{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$user&amp;nbsp;=&amp;nbsp;null;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$table_users&amp;nbsp;=&amp;nbsp;&amp;#39;users&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$table_access_token&amp;nbsp;=&amp;nbsp;&amp;#39;access_token&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$table_role_group&amp;nbsp;=&amp;nbsp;&amp;#39;role_group&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$table_rule&amp;nbsp;=&amp;nbsp;&amp;#39;rule&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$table_role_user_play&amp;nbsp;=&amp;nbsp;&amp;#39;role_user_play&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;const&amp;nbsp;TYPE_MEMBER&amp;nbsp;=&amp;nbsp;0;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;const&amp;nbsp;TYPE_OWNER&amp;nbsp;=&amp;nbsp;1;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;const&amp;nbsp;TYPE_EVERYONE&amp;nbsp;=&amp;nbsp;2;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$targetModel&amp;nbsp;=&amp;nbsp;null;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$targetKey&amp;nbsp;=&amp;nbsp;null;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;$foreignKey&amp;nbsp;=&amp;nbsp;null;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;__construct()&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;foreignKey&amp;nbsp;=&amp;nbsp;$this-&amp;gt;table_users.&amp;#39;_id&amp;#39;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;设置检查模块对象信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$t&amp;nbsp;对象模块名称
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$key&amp;nbsp;目标主键
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;null&amp;nbsp;$f&amp;nbsp;外键
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;setTargetModel($arr){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$t&amp;nbsp;=&amp;nbsp;$arr[0];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$key&amp;nbsp;=&amp;nbsp;$arr[1];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$f&amp;nbsp;=&amp;nbsp;$arr[2];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$f&amp;nbsp;==&amp;nbsp;null&amp;nbsp;||&amp;nbsp;$this-&amp;gt;foreignKey&amp;nbsp;=&amp;nbsp;$f;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;targetModel&amp;nbsp;=&amp;nbsp;$t;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;targetKey&amp;nbsp;=&amp;nbsp;$key;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;判断用户是否已经登录
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$accesstoken
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;bool
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;function&amp;nbsp;checkLogin(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$userModel&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;table_users);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accesstoken&amp;nbsp;=&amp;nbsp;I(&amp;#39;server.HTTP_ACCESS_TOKEN&amp;#39;,null);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$accesstoken){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;请输入您的accesstoken!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accessTokenModel&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;table_access_token);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$tokenInfo&amp;nbsp;=&amp;nbsp;$accessTokenModel-&amp;gt;where(&amp;quot;&amp;#39;token&amp;nbsp;=&amp;nbsp;&amp;#39;%s&amp;#39;&amp;quot;,$accesstoken)-&amp;gt;find();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$tokenInfo){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;认证失败!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if($tokenInfo[&amp;#39;failuretime&amp;#39;]&amp;nbsp;&amp;lt;&amp;nbsp;time()){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;认证已经失效,请重新认证!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;user&amp;nbsp;=&amp;nbsp;$userModel-&amp;gt;find($tokenInfo[&amp;#39;uid&amp;#39;]);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;true;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;refreshToken(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accesstoken&amp;nbsp;=&amp;nbsp;I(&amp;#39;server.HTTP_ACCESS_TOKEN&amp;#39;,null);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$accesstoken){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;请输入您的accesstoken!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accessTokenModel&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;table_access_token);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$tokenInfo&amp;nbsp;=&amp;nbsp;$accessTokenModel-&amp;gt;where(&amp;quot;&amp;#39;token&amp;nbsp;=&amp;nbsp;&amp;#39;%s&amp;#39;&amp;quot;,$accesstoken)-&amp;gt;find();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$tokenInfo){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;无效请输入您的accesstoken!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if($tokenInfo[&amp;#39;failuretime&amp;#39;]&amp;nbsp;&amp;lt;&amp;nbsp;time()){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;认证已经失效,请重新认证!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$time&amp;nbsp;=&amp;nbsp;strtotime(&amp;quot;+30&amp;nbsp;day&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$data&amp;nbsp;=&amp;nbsp;array(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;failuretime&amp;#39;=&amp;gt;&amp;nbsp;$time
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accessTokenModel-&amp;gt;where(&amp;quot;&amp;#39;token&amp;nbsp;=&amp;nbsp;&amp;#39;%s&amp;#39;&amp;quot;,$accesstoken)-&amp;gt;save($data);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$time;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;判断用户是否具有操作权限
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$actionname
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;bool
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;checkPermission($actionname){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//获取动作的定义信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$rule&amp;nbsp;=&amp;nbsp;$ruleModel&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;table_rule)-&amp;gt;where(&amp;quot;action&amp;nbsp;=&amp;nbsp;&amp;#39;%s&amp;#39;&amp;quot;,$actionname)-&amp;gt;find();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//未定义的动作和允许任何人操作的动作直接通过
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$rule&amp;nbsp;||&amp;nbsp;$rule[&amp;#39;type&amp;#39;]&amp;nbsp;==&amp;nbsp;$this::TYPE_EVERYONE)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;true;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//判断用户登录与非
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$this-&amp;gt;checkLogin())&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$checkResult&amp;nbsp;=&amp;nbsp;false;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//获取该用户的用户组并关联出该用户组拥有的全部动作id集合
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$roleUserPlayModel&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;table_role_user_play)-&amp;gt;where(&amp;#39;uid&amp;nbsp;=&amp;nbsp;%d&amp;#39;,$this-&amp;gt;user[&amp;#39;id&amp;#39;]);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$roleUserPlayModel&amp;nbsp;=&amp;nbsp;$roleUserPlayModel-&amp;gt;join($this-&amp;gt;table_role_group.&amp;#39;&amp;nbsp;AS&amp;nbsp;table_role_group&amp;nbsp;on&amp;nbsp;&amp;#39;.$this-&amp;gt;table_rule.&amp;#39;.rid&amp;nbsp;=&amp;nbsp;table_role_group.id&amp;#39;,&amp;#39;LEFT&amp;#39;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$groups&amp;nbsp;=&amp;nbsp;$roleUserPlayModel-&amp;gt;select();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$permission_ids&amp;nbsp;=&amp;nbsp;array();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;foreach($groups&amp;nbsp;as&amp;nbsp;$group){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$ids&amp;nbsp;=&amp;nbsp;explode(&amp;#39;,&amp;#39;,$groups[&amp;#39;rules&amp;#39;]);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$permission_ids&amp;nbsp;=&amp;nbsp;array_merge($permission_ids,$ids);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$permission_ids&amp;nbsp;=&amp;nbsp;array_unique($permission_ids);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//判断动作是否
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(in_array($rule[&amp;#39;id&amp;#39;],$permission_ids))&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$checkResult&amp;nbsp;=&amp;nbsp;true;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(!empty($rule[&amp;#39;condition&amp;#39;]))&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//条件验证
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$user&amp;nbsp;=&amp;nbsp;$this-&amp;gt;user;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$command&amp;nbsp;=&amp;nbsp;preg_replace(&amp;#39;/\\{(\\w*?)\\}/&amp;#39;,&amp;nbsp;&amp;#39;$user[\\&amp;#39;\\\\1\\&amp;#39;]&amp;#39;,&amp;nbsp;$rule[&amp;#39;condition&amp;#39;]);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//dump($command);//debug
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$condition&amp;nbsp;=&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@(eval(&amp;#39;$condition=(&amp;#39;&amp;nbsp;.&amp;nbsp;$command&amp;nbsp;.&amp;nbsp;&amp;#39;);&amp;#39;));&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(!$condition)&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;quot;用户&amp;nbsp;$command&amp;nbsp;,不符合要求的&amp;nbsp;&amp;quot;.$rule[&amp;#39;condition&amp;#39;].&amp;quot;&amp;nbsp;条件!&amp;quot;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//判断是否需要验证用户是否拥有模块
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if($rule[&amp;#39;type&amp;#39;]&amp;nbsp;==&amp;nbsp;$this::TYPE_OWNER){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$checkResult&amp;nbsp;=&amp;nbsp;$this-&amp;gt;checkOwner();
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$checkResult;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;判断操作对象所有权
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$checkmodel
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;string&amp;nbsp;$foreign
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;bool
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;function&amp;nbsp;checkOwner(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if($this-&amp;gt;targetModel&amp;nbsp;==&amp;nbsp;null&amp;nbsp;||&amp;nbsp;$this-&amp;gt;targetKey&amp;nbsp;==&amp;nbsp;null)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$result&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;targetModel)-&amp;gt;find($this-&amp;gt;targetKey);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if($result[$this-&amp;gt;foreignKey]&amp;nbsp;==&amp;nbsp;$this-&amp;gt;user[&amp;#39;id&amp;#39;]){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;true;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;errormsg&amp;nbsp;=&amp;nbsp;&amp;#39;您没有权限操作该资源!&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;颁发用户token
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$uid
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;int&amp;nbsp;$days
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;$time
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;null|string
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;awardAccessToken($uid,$days&amp;nbsp;=&amp;nbsp;30,&amp;amp;$time){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$token&amp;nbsp;=&amp;nbsp;$this-&amp;gt;getRandChar();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accessTokenModel&amp;nbsp;=&amp;nbsp;M($this-&amp;gt;table_access_token);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$time&amp;nbsp;=&amp;nbsp;strtotime(&amp;quot;+$days&amp;nbsp;day&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$data&amp;nbsp;=&amp;nbsp;array(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;token&amp;#39;=&amp;gt;$token,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;uid&amp;#39;=&amp;gt;$uid,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;failuretime&amp;#39;=&amp;gt;&amp;nbsp;$time
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$accessTokenModel-&amp;gt;add($data);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$token;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;获取错误信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;string
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;getErroeMsg(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$this-&amp;gt;errormsg;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;生成随机字符串
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;int&amp;nbsp;$length
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;null|string
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private&amp;nbsp;function&amp;nbsp;getRandChar($length&amp;nbsp;=&amp;nbsp;60){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$str&amp;nbsp;=&amp;nbsp;null;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$strPol&amp;nbsp;=&amp;nbsp;&amp;quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz&amp;quot;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$max&amp;nbsp;=&amp;nbsp;strlen($strPol)-1;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for($i=0;$i&amp;lt;$length;$i++){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$str.=$strPol[mt_rand(0,$max)];//mt_rand($min,$max)生成介于min和max两个数之间的一个随机整数
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$str;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;&lt;h3 id=&quot;articleHeader4&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.5em; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;设置验证权限行为&lt;/h3&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;在&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Application/Common/Conf&lt;/code&gt;下建立&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;tags.php&lt;/code&gt;内容如下：&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;lt;?php/**
&amp;nbsp;*&amp;nbsp;Created&amp;nbsp;by&amp;nbsp;PhpStorm.
&amp;nbsp;*&amp;nbsp;User:&amp;nbsp;rojer
&amp;nbsp;*&amp;nbsp;Date:&amp;nbsp;16/3/30
&amp;nbsp;*&amp;nbsp;Time:&amp;nbsp;下午1:59
&amp;nbsp;*/return&amp;nbsp;array(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;auth&amp;#39;=&amp;gt;array(&amp;#39;Home\\\\Behaviors\\\\AuthBehavior&amp;#39;),
);&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;然后我们在Application/Home/Behaviors下建立AuthBehavior.class.php，代码如下：&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;lt;?phpnamespace&amp;nbsp;Home\\Behaviors;/**
&amp;nbsp;*&amp;nbsp;Created&amp;nbsp;by&amp;nbsp;PhpStorm.
&amp;nbsp;*&amp;nbsp;User:&amp;nbsp;rojer
&amp;nbsp;*&amp;nbsp;Date:&amp;nbsp;16/3/30
&amp;nbsp;*&amp;nbsp;Time:&amp;nbsp;下午2:01
&amp;nbsp;*/class&amp;nbsp;AuthBehavior&amp;nbsp;extends&amp;nbsp;\\Think\\Behavior{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;执行行为&amp;nbsp;run方法是Behavior唯一的接口
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@access&amp;nbsp;public
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@param&amp;nbsp;mixed&amp;nbsp;$params&amp;nbsp;行为参数
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&amp;nbsp;@return&amp;nbsp;void
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;run(&amp;amp;$params)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$auth&amp;nbsp;=&amp;nbsp;new&amp;nbsp;\\Org\\Util\\Auth();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$params-&amp;gt;setAuth($auth);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$auth-&amp;gt;setTargetModel($params-&amp;gt;getTargetModel());&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$auth_result&amp;nbsp;=&amp;nbsp;$auth-&amp;gt;checkPermission(CONTROLLER_NAME.&amp;#39;::&amp;#39;.ACTION_NAME);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!$auth_result){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$params-&amp;gt;error($auth-&amp;gt;getErroeMsg());
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;之后我们要建立一个抽象类&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Application/Home/Controller/BaseController.class.php&lt;/code&gt;继承自&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Controller&lt;/code&gt;代码如下：&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;lt;?php/**
&amp;nbsp;*&amp;nbsp;Created&amp;nbsp;by&amp;nbsp;PhpStorm.
&amp;nbsp;*&amp;nbsp;User:&amp;nbsp;rojer
&amp;nbsp;*&amp;nbsp;Date:&amp;nbsp;16/4/5
&amp;nbsp;*&amp;nbsp;Time:&amp;nbsp;下午9:28
&amp;nbsp;*/namespace&amp;nbsp;Home\\Controller;use&amp;nbsp;Think\\Controller;abstract&amp;nbsp;class&amp;nbsp;BaseController&amp;nbsp;extends&amp;nbsp;Controller{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;abstract&amp;nbsp;function&amp;nbsp;getTargetModel();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;protected&amp;nbsp;$auth&amp;nbsp;=&amp;nbsp;null;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;setAuth($self){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;auth&amp;nbsp;=&amp;nbsp;$self;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;_initialize(){
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;\\Think\\Hook::listen(&amp;#39;auth&amp;#39;,&amp;nbsp;$this);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;error($data,$status=-1){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$this-&amp;gt;ajaxReturn(array(&amp;#39;msg&amp;#39;=&amp;gt;$data,&amp;#39;status&amp;#39;=&amp;gt;$status));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;最后我们把&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;Application/Home/Controller/IndexController.class.php&lt;/code&gt;继承自&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;BaseController&lt;/code&gt;并实现&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;getTargetModel&lt;/code&gt;方法即可：&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;&amp;lt;?phpnamespace&amp;nbsp;Home\\Controller;use&amp;nbsp;Think\\Controller;class&amp;nbsp;IndexController&amp;nbsp;extends&amp;nbsp;BaseController&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public&amp;nbsp;function&amp;nbsp;index(){
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;getTargetModel()
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;array(&amp;#39;test&amp;#39;,I(&amp;#39;a&amp;#39;),&amp;#39;uid&amp;#39;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;在数据库中，我们插入&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;INSERT&amp;nbsp;INTO&amp;nbsp;`rule`&amp;nbsp;(`id`,&amp;nbsp;`action`,&amp;nbsp;`name`,&amp;nbsp;`condition`,&amp;nbsp;`type`)VALUES
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(1,&amp;nbsp;&amp;#39;Index::index&amp;#39;,&amp;nbsp;&amp;#39;测试&amp;#39;,&amp;nbsp;&amp;#39;{nick}=\\&amp;#39;1\\&amp;#39;&amp;#39;,&amp;nbsp;0);&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;之后访问&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;http://localhost/news/1&lt;/code&gt;就能看到&lt;/p&gt;&lt;pre style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-top: 1.5em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative;&quot;&gt;{&amp;quot;msg&amp;quot;:&amp;nbsp;&amp;quot;请输入您的accesstoken!&amp;quot;,&amp;nbsp;&amp;quot;status&amp;quot;:&amp;nbsp;-1}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;的提示。&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;基础Auth部分完毕&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;Git地址：&lt;a href=&quot;https://github.com/enjory520/shizai.git&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;https://github.com/enjory520/shizai.git&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489586294') [ RunTime:0.2754s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000055s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000136s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.122645s ]
INFO: [ view_parse ] --END-- [ RunTime:0.122715s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000191s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000222s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0326s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0247s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000099s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.177736s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.134221s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.058065s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000010s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.192120s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000724s ]
INFO: [ app_end ] --END-- [ RunTime:0.000824s ]

[ 2017-03-15T21:58:17+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.044058s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.037651s ]
INFO: [ app_begin ] --END-- [ RunTime:0.037740s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0264s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0263s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000083s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000151s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.220730s ]
INFO: [ view_parse ] --END-- [ RunTime:0.220803s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000299s ]
INFO: [ view_filter ] --END-- [ RunTime:0.034407s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000472s ]
INFO: [ app_end ] --END-- [ RunTime:0.000496s ]

[ 2017-03-15T21:59:02+08:00 ] 183.232.228.22 /Admin.php/img/codeTools.svg
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000017s ]
INFO: [ app_init ] --END-- [ RunTime:0.000354s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000407s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000474s ]
ERR: 无法加载控制器:Img

[ 2017-03-15T21:59:16+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000018s ]
INFO: [ app_init ] --END-- [ RunTime:0.000323s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000571s ]
INFO: [ app_begin ] --END-- [ RunTime:0.047718s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0253s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES ('PC端微信扫码支付','1','PC端微信扫码支付','&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;第一步 首先把官方的微信demo下载下来进行配置部署&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;给大家个传送门-&amp;gt;&amp;nbsp;&lt;a href=&quot;https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_1&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;PHP微信支付demo下载&lt;/a&gt;&lt;/p&gt;&lt;pre class=&quot;hljs&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;nbsp;拿到文件后解压，解压后把文件夹改名为payment（也可以随意改，但是博主觉得这样规范点！）而后上传至项目的根目录，各位大佬不知道什么是根目录就请看这（/）.其实我是逗你们的。
&amp;nbsp;
&amp;nbsp;
&amp;nbsp;而后进入微信的商户后台，设置api的key注意看下图（网上随意找的~丑了点，将就吧！）设置完后，下载证书文件。而后把证书解压出来！放到微信支付demo里面，也就是上一步上传服务器的demo文件夹中！下面是详细步骤：&lt;/pre&gt;&lt;ol style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;设置密钥（如图）&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;&lt;img data-src=&quot;/img/bVKgHt?w=1722&amp;amp;h=614&quot; src=&quot;https://segmentfault.com/img/bVKgHt?w=1722&amp;h=614&quot; style=&quot;box-sizing: border-box; border: 1px solid rgb(221, 221, 221); vertical-align: middle; max-width: 100%; position: static !important; padding: 3px; cursor: pointer; display: inline;&quot;/&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;下载证书，得到压缩文件夹，解压后上传到payment中的cert中！（如图，图上有路径）&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;&lt;img data-src=&quot;/img/bVKgIb?w=1350&amp;amp;h=382&quot; src=&quot;https://segmentfault.com/img/bVKgIb?w=1350&amp;h=382&quot; style=&quot;box-sizing: border-box; border: 1px solid rgb(221, 221, 221); vertical-align: middle; max-width: 100%; position: static !important; padding: 3px; cursor: pointer; display: inline;&quot;/&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;在此顺便给logs文件夹（支付日志）一个写入的权限&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;&lt;img data-src=&quot;/img/bVKgKy?w=766&amp;amp;h=982&quot; src=&quot;https://segmentfault.com/img/bVKgKy?w=766&amp;h=982&quot; style=&quot;box-sizing: border-box; border: 1px solid rgb(221, 221, 221); vertical-align: middle; max-width: 100%; position: static !important; padding: 3px; cursor: pointer; display: inline;&quot;/&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;修改微信支付demo中的配置文件WxPay.Config.php(如图：路径)&lt;br style=&quot;box-sizing: border-box;&quot;/&gt;&lt;img data-src=&quot;/img/bVKgIR?w=1166&amp;amp;h=328&quot; src=&quot;https://segmentfault.com/img/bVKgIR?w=1166&amp;h=328&quot; style=&quot;box-sizing: border-box; border: 1px solid rgb(221, 221, 221); vertical-align: middle; max-width: 100%; position: static !important; padding: 3px; cursor: pointer; display: inline;&quot;/&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;pre class=&quot;hljs cs&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;//只用修改第25、26、27、28行（示例）const&amp;nbsp;APPID&amp;nbsp;=&amp;nbsp;&amp;#39;wx2a3f1e5246886123&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//微信公众号的APPIDconst&amp;nbsp;MCHID&amp;nbsp;=&amp;nbsp;&amp;#39;1300778123&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//微信商户号&amp;nbsp;&amp;nbsp;&amp;nbsp;const&amp;nbsp;KEY&amp;nbsp;=&amp;nbsp;&amp;#39;619fd0f3f9c64550964bbe5b94dba123&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//微信商户密钥（上面步骤中设置的那个）const&amp;nbsp;APPSECRET&amp;nbsp;=&amp;nbsp;&amp;#39;5c8289b72600936f813ec1939e68f123&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//微信公众号的APPSECRET&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;第一步分的配置咋们就完成了，请各位大佬继续跟着小的往下走！&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;第二部 调整前段代码 大部分都是JS，不懂JS得直接略过吧，否则看着难受！&lt;/p&gt;&lt;/blockquote&gt;&lt;pre class=&quot;hljs&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;对于点击后弹出支付的这一块逻辑，撸主的思路是：点击支付按钮-&amp;gt;执行Ajax获取到二维码展示在页面-&amp;gt;开始执行轮询获取支付状态；（撸主虽然JS很菜，但是每一条代码后面都会注释给大家，比我菜的可以看一下）&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;创建获取二维码的文件 getPayQrcode.php&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs xml&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;lt;?php
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;放入老衲前不久写的curl函数&amp;nbsp;用curl方法获取二维码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;curlGet($url)&amp;nbsp;{&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$ch&amp;nbsp;=&amp;nbsp;curl_init();&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_URL,&amp;nbsp;$url);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_RETURNTRANSFER,&amp;nbsp;1);&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_HEADER,&amp;nbsp;false);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_FOLLOWLOCATION,&amp;nbsp;1);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;curl_exec($ch);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;正式流程开始&amp;nbsp;返回的二维码是带信息的，所以需要先接收商品信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;比如:我是get过来商品的id，而后再进行查询数据库；这里大家随意；
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$goodsId&amp;nbsp;=&amp;nbsp;$_GET[&amp;#39;goodsId&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;利用商品ID查询到商品名称和价格
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$goodsName&amp;nbsp;=&amp;nbsp;&amp;#39;好日子牌姨妈巾&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$goodsPrice&amp;nbsp;=&amp;nbsp;&amp;#39;250&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;下面构造请求二维码的链接（由于是获取二维码支付，所以咋们请求的是native.php;后面会对该文件进行详细讲解）
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$url&amp;nbsp;=&amp;nbsp;&amp;#39;http://www.baidu.com/payment/example/native.php?goodsName=&amp;#39;.$goodsName.&amp;#39;&amp;amp;goodsPrice=&amp;#39;.goodsPrice;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;执行curlGet()函数
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$data&amp;nbsp;=&amp;nbsp;curlGet($url);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;preg_match_all函数进行全局正则表达式匹配,获取到二维码的链接。&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;preg_match(&amp;#39;/&amp;lt;\\s*img\\s+[^&amp;gt;]*?src\\s*=\\s*(\\&amp;#39;|\\&amp;quot;)(.*?)\\\\1[^&amp;gt;]*?\\/?\\s*&amp;gt;/i&amp;#39;,$data,$matches);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;preg_match(&amp;#39;/\\|\\|(.*)\\|\\|/&amp;#39;,$matches[0],$aac);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;构造返回信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;status&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;#39;success&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;code&amp;#39;]&amp;nbsp;=&amp;nbsp;$aac[1];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;此值为返回交易码【用来确认订单支付状态的】
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;price&amp;#39;]&amp;nbsp;=&amp;nbsp;$goodsPrice;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;msg&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;#39;/payment/example/&amp;#39;.$matches[&amp;#39;2&amp;#39;];&amp;nbsp;//&amp;nbsp;请求返回的二维码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;json_encode($obj);//&amp;nbsp;返回json
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;获取二维码的文件已经ok！继续下一步&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;设置微信支付demo中的扫码支付文件 payment/example/native.php&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs php&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;//在大概19行找到该代码&amp;nbsp;$notify&amp;nbsp;=&amp;nbsp;new&amp;nbsp;NativePay();&amp;nbsp;并在下方添加获取商品名字和商品价格的代码//&amp;nbsp;接收get过来的商品价格和名称$goodsPrice&amp;nbsp;=&amp;nbsp;$_GET[&amp;#39;goodsPrice&amp;#39;];$goodsName&amp;nbsp;=&amp;nbsp;$_GET[&amp;#39;goodsName&amp;#39;];//下面修改从第32号开始的一大堆$input开头的$input&amp;nbsp;=&amp;nbsp;new&amp;nbsp;WxPayUnifiedOrder();$input-&amp;gt;SetBody($goodsName);//商品名称$input-&amp;gt;SetAttach(&amp;quot;大姨妈商城&amp;quot;);//自己设置$num&amp;nbsp;=&amp;nbsp;WxPayConfig::MCHID.date(&amp;quot;YmdHis&amp;quot;);//订单号$input-&amp;gt;SetOut_trade_no($num);$input-&amp;gt;SetTotal_fee($goodsPrice*100);//注意！！！！！！！！！由于是以分为单位结算，所以一定要记得商品价格*100；别到时候下岗了来怪撸主$input-&amp;gt;SetTime_start(date(&amp;quot;YmdHis&amp;quot;));$input-&amp;gt;SetTime_expire(date(&amp;quot;YmdHis&amp;quot;,&amp;nbsp;time()&amp;nbsp;+&amp;nbsp;600));$input-&amp;gt;SetGoods_tag($goodsName);//下面的这些参数大家自己看一下文档吧！意义都不大，撸主肾虚，要早点写完早点睡!$input-&amp;gt;SetNotify_url(&amp;quot;/payment/example/notify.php&amp;quot;);$input-&amp;gt;SetTrade_type(&amp;quot;NATIVE&amp;quot;);$input-&amp;gt;SetProduct_id(&amp;quot;123456789&amp;quot;);$result&amp;nbsp;=&amp;nbsp;$notify-&amp;gt;GetPayUrl($input);//print_r($result);//最终的信息，大家可以打印了进行调试$url2&amp;nbsp;=&amp;nbsp;$result[&amp;quot;code_url&amp;quot;];//&amp;nbsp;ok！整个文件的PHP代码就完毕了！在这以下的html代码全部把它干掉，把撸主准备的这段贴上去&amp;nbsp;这段代码不做什么解释了，也是用于查询订单状态的轮询，调试用的~！下面还会用到一次，讲的很详细&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;meta&amp;nbsp;http-equiv=&amp;quot;content-type&amp;quot;&amp;nbsp;content=&amp;quot;text/html;charset=utf-8&amp;quot;/&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;meta&amp;nbsp;name=&amp;quot;viewport&amp;quot;&amp;nbsp;content=&amp;quot;width=device-width,&amp;nbsp;initial-scale=1&amp;quot;&amp;nbsp;/&amp;gt;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;title&amp;gt;微信支付样例&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;div&amp;nbsp;style=&amp;quot;margin-left:&amp;nbsp;10px;color:#556B2F;font-size:30px;font-weight:&amp;nbsp;bolder;&amp;quot;&amp;gt;扫描支付模式二&amp;lt;/div&amp;gt;&amp;lt;br/&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;img&amp;nbsp;alt=&amp;quot;||&amp;lt;?php&amp;nbsp;echo&amp;nbsp;$num?&amp;gt;||&amp;quot;&amp;nbsp;src=&amp;quot;qrcode.php?data=&amp;lt;?php&amp;nbsp;echo&amp;nbsp;urlencode($url2);?&amp;gt;&amp;quot;&amp;nbsp;style=&amp;quot;width:150px;height:150px;&amp;quot;/&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;div&amp;nbsp;id=&amp;quot;myDiv&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;id=&amp;quot;timer&amp;quot;&amp;gt;0&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;script&amp;gt;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//设置每隔1000毫秒执行一次load()&amp;nbsp;方法&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;myIntval=setInterval(function(){load()},1000);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;load(){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;timer&amp;quot;).innerHTML=parseInt(document.getElementById(&amp;quot;timer&amp;quot;).innerHTML)+1;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;xmlhttp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(window.XMLHttpRequest){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE7+,&amp;nbsp;Firefox,&amp;nbsp;Chrome,&amp;nbsp;Opera,&amp;nbsp;Safari&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;XMLHttpRequest();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE6,&amp;nbsp;IE5&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;ActiveXObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.onreadystatechange=function(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(xmlhttp.readyState==4&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;xmlhttp.status==200){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;trade_state=xmlhttp.responseText;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(trade_state==&amp;#39;SUCCESS&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付成功&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//alert(transaction_id);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//延迟3000毫秒执行tz()&amp;nbsp;方法
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;setTimeout(&amp;quot;location.href=&amp;#39;success.php&amp;#39;&amp;quot;,3000);&amp;nbsp;&amp;nbsp;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;REFUND&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;转入退款&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;NOTPAY&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;请扫码支付&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;CLOSED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已关闭&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;REVOKED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已撤销&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;USERPAYING&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;用户支付中&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;PAYERROR&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付失败&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//orderquery.php&amp;nbsp;文件返回订单状态，通过订单状态确定支付状态&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.open(&amp;quot;POST&amp;quot;,&amp;quot;orderquery.php&amp;quot;,false);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//下面这句话必须有&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//把标签/值对添加到要发送的头文件。&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.setRequestHeader(&amp;quot;Content-type&amp;quot;,&amp;quot;application/x-www-form-urlencoded&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.send(&amp;quot;out_trade_no=&amp;lt;?php&amp;nbsp;echo&amp;nbsp;$num;?&amp;gt;&amp;quot;);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;/script&amp;gt;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;微信支付demo订单查询文件 payment/example/orderquery.php&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs php&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;header(&amp;quot;Access-Control-Allow-Origin:*&amp;quot;);&amp;nbsp;//&amp;nbsp;因为撸主的支付实在另外一台服务器上，所以给了一个域头ini_set(&amp;#39;date.timezone&amp;#39;,&amp;#39;Asia/Shanghai&amp;#39;);//&amp;nbsp;设置一下时区error_reporting(E_ERROR);&amp;nbsp;//&amp;nbsp;关闭报错require_once&amp;nbsp;&amp;quot;../lib/WxPay.Api.php&amp;quot;;require_once&amp;nbsp;&amp;#39;log.php&amp;#39;;&amp;nbsp;
//初始化日志$logHandler=&amp;nbsp;new&amp;nbsp;CLogFileHandler(&amp;quot;./logs/&amp;quot;.date(&amp;#39;Y-m-d&amp;#39;).&amp;#39;.log&amp;#39;);$log&amp;nbsp;=&amp;nbsp;Log::Init($logHandler,&amp;nbsp;15);&amp;nbsp;
function&amp;nbsp;printf_info($data){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;foreach($data&amp;nbsp;as&amp;nbsp;$key=&amp;gt;$value){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;&amp;quot;&amp;lt;font&amp;nbsp;color=&amp;#39;#f00;&amp;#39;&amp;gt;$key&amp;lt;/font&amp;gt;&amp;nbsp;:&amp;nbsp;$value&amp;nbsp;&amp;lt;br/&amp;gt;&amp;quot;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&amp;nbsp;
//&amp;nbsp;一下两个if的判断均为判断订单的状态，这里撸主建议去微信官网进行查阅，下面有传送门送你过去if(isset($_REQUEST[&amp;quot;transaction_id&amp;quot;])&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;$_REQUEST[&amp;quot;transaction_id&amp;quot;]&amp;nbsp;!=&amp;nbsp;&amp;quot;&amp;quot;){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$transaction_id&amp;nbsp;=&amp;nbsp;$_REQUEST[&amp;quot;transaction_id&amp;quot;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$input&amp;nbsp;=&amp;nbsp;new&amp;nbsp;WxPayOrderQuery();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$input-&amp;gt;SetTransaction_id($transaction_id);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//printf_info(WxPayApi::orderQuery($input));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$result=WxPayApi::orderQuery($input);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$result[&amp;#39;trade_state&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;exit();
}&amp;nbsp;
if(isset($_REQUEST[&amp;quot;out_trade_no&amp;quot;])&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;$_REQUEST[&amp;quot;out_trade_no&amp;quot;]&amp;nbsp;!=&amp;nbsp;&amp;quot;&amp;quot;){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$out_trade_no&amp;nbsp;=&amp;nbsp;$_REQUEST[&amp;quot;out_trade_no&amp;quot;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$input&amp;nbsp;=&amp;nbsp;new&amp;nbsp;WxPayOrderQuery();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$input-&amp;gt;SetOut_trade_no($out_trade_no);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//printf_info(WxPayApi::orderQuery($input));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$result=WxPayApi::orderQuery($input);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$status[&amp;#39;code&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;nbsp;$result[&amp;#39;trade_state&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$status[&amp;#39;openid&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;nbsp;$result[&amp;#39;openid&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$status[&amp;#39;total_fee&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;nbsp;$result[&amp;#39;total_fee&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$status[&amp;#39;transaction_id&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;nbsp;$result[&amp;#39;transaction_id&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$status[&amp;#39;time&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;nbsp;$result[&amp;#39;time_end&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//print_r($result);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;print_r(json_encode($status));&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;exit();
}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;a href=&quot;https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;传送门&lt;/span&gt;&lt;/a&gt;&amp;nbsp;微信返回错误代码解释&lt;/p&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;点击支付按钮的代码&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs cs&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;//&amp;nbsp;前段代码&amp;nbsp;样式用大家自己的就行，不用照抄&amp;lt;div&amp;nbsp;class=&amp;quot;goods_btn&amp;quot;&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;div&amp;nbsp;class=&amp;quot;buy&amp;quot;&amp;nbsp;onclick=&amp;quot;GetPay()&amp;quot;&amp;gt;立即购买&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;//&amp;nbsp;JS代码&amp;nbsp;js代码中嵌入的样式，无需修改！和效果图一样的！//接入微信扫码支付function&amp;nbsp;GetPay()&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;用ajax获取到支付的二维码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;payQrcode&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;payPrice&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;payOrderCode&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;执行Ajax请求
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$.get(&amp;#39;/getPayQrcode.php&amp;#39;,{&amp;quot;goodsId&amp;quot;:&amp;quot;商品的ID&amp;quot;},function(ret){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;obj&amp;nbsp;=&amp;nbsp;JSON.parse(ret)&amp;nbsp;//&amp;nbsp;把字符串进行转换
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;判断返回数据是否正常(由于请求一般不会出问题，所以在获取二维码的getPayQrcode.php文件没有写返回fail)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(obj.status&amp;nbsp;==&amp;nbsp;&amp;#39;success&amp;#39;)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;payQrcode&amp;nbsp;=&amp;nbsp;&amp;#39;http://www.baidu.com&amp;#39;+obj.msg;//二维码链接
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;payPrice&amp;nbsp;=&amp;nbsp;obj.price;&amp;nbsp;//商品价格
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;payOrderCode&amp;nbsp;=&amp;nbsp;obj.code;&amp;nbsp;//交易码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//执行layer弹层
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;layer.open({
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;type:&amp;nbsp;1,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;skin:&amp;nbsp;&amp;#39;layui-layer-demo&amp;#39;,&amp;nbsp;//样式类名，随意！
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;closeBtn:&amp;nbsp;0,&amp;nbsp;//不显示关闭按钮
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;title:false,&amp;nbsp;//关闭title部分
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;anim:&amp;nbsp;2,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;area:&amp;nbsp;[&amp;#39;300px&amp;#39;,&amp;nbsp;&amp;#39;450px&amp;#39;],&amp;nbsp;//层的宽高
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;shadeClose:&amp;nbsp;true,&amp;nbsp;//开启遮罩关闭
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;content:&amp;nbsp;&amp;#39;&amp;lt;div&amp;nbsp;style=&amp;quot;color:&amp;nbsp;#666;margin:&amp;nbsp;5px&amp;nbsp;0&amp;nbsp;0&amp;nbsp;10px;position:&amp;nbsp;absolute;right:.5rem;&amp;quot;&amp;nbsp;onclick=&amp;quot;layer.closeAll()&amp;quot;&amp;gt;X&amp;lt;/div&amp;gt;&amp;#39;+&amp;#39;&amp;lt;div&amp;nbsp;style=&amp;quot;text-align:&amp;nbsp;center;&amp;quot;&amp;gt;&amp;lt;img&amp;nbsp;style=&amp;quot;width:&amp;nbsp;4rem;padding:2rem&amp;nbsp;0&amp;nbsp;1rem&amp;nbsp;0;&amp;quot;&amp;nbsp;src=&amp;quot;{{&amp;nbsp;asset(&amp;#39;./images/wx.png&amp;#39;)&amp;nbsp;}}&amp;quot;&amp;nbsp;alt=&amp;quot;&amp;quot;&amp;nbsp;/&amp;gt;&amp;lt;br&amp;gt;&amp;lt;b&amp;nbsp;style=&amp;quot;font-weight:&amp;nbsp;100;color:&amp;nbsp;#888;&amp;quot;&amp;gt;请打开微信&amp;nbsp;扫码进行支付&amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;div&amp;nbsp;class=&amp;quot;blank&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;支付金额：&amp;lt;span&amp;nbsp;style=&amp;quot;color:&amp;nbsp;red;&amp;quot;&amp;gt;&amp;#39;+payPrice+&amp;#39;&amp;lt;/span&amp;gt;&amp;nbsp;元&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;class=&amp;quot;blank&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;+&amp;#39;&amp;lt;div&amp;nbsp;style=&amp;quot;text-align:&amp;nbsp;center&amp;quot;&amp;gt;&amp;lt;img&amp;nbsp;src=&amp;quot;&amp;#39;+payQrcode+&amp;#39;&amp;quot;&amp;nbsp;class=&amp;quot;resize&amp;quot;&amp;nbsp;style=&amp;quot;width:70%;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;id=&amp;quot;myDiv&amp;quot;&amp;nbsp;style=&amp;quot;width:&amp;nbsp;100%;height:&amp;nbsp;1.5rem;bottom:&amp;nbsp;2rem;position:absolute;text-align:center;font-size:&amp;nbsp;1.2rem;color:&amp;nbsp;#04BE02;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;id=&amp;quot;timer&amp;quot;&amp;nbsp;style=&amp;quot;display:none;&amp;quot;&amp;gt;0&amp;lt;/div&amp;gt;&amp;#39;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;});&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;轮询代码开始
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;设置每隔1000毫秒执行一次load()&amp;nbsp;方法&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;myIntval=setInterval(function(){load()},1000);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;load(){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;xmlhttp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;轮询的浏览器设置&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(window.XMLHttpRequest){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE7+,&amp;nbsp;Firefox,&amp;nbsp;Chrome,&amp;nbsp;Opera,&amp;nbsp;Safari&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;XMLHttpRequest();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE6,&amp;nbsp;IE5&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;ActiveXObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.onreadystatechange=function(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(xmlhttp.readyState==4&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;xmlhttp.status==200){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;trade_state=JSON.parse(xmlhttp.responseText);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;console.log(trade_state);//打印查看轮询的状态，也可以关闭。
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//判断订单支付状态&amp;nbsp;并用document.getElementById方法赋值到myDiv中；
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(trade_state.code==&amp;#39;SUCCESS&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付成功&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//延迟3000毫秒执行tz()&amp;nbsp;方法
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//进行跳转。
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;setTimeout(&amp;quot;location.href=&amp;#39;./&amp;quot;,1500);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;REFUND&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;转入退款&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;NOTPAY&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;请扫码支付&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;CLOSED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已关闭&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;REVOKED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已撤销&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;USERPAYING&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;用户支付中&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;PAYERROR&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付失败&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//orderquery.php&amp;nbsp;文件返回订单状态，通过订单状态确定支付状态&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.open(&amp;quot;POST&amp;quot;,&amp;quot;http://www.baidu.com/payment/example/orderquery.php&amp;quot;,false);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//下面这句话必须有&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//把标签/值对添加到要发送的头文件。&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.setRequestHeader(&amp;quot;Content-type&amp;quot;,&amp;quot;application/x-www-form-urlencoded&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.send(&amp;quot;out_trade_no=&amp;quot;+payOrderCode+&amp;quot;&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;layer.msg(&amp;#39;请求失败！&amp;#39;,&amp;nbsp;{icon:&amp;nbsp;5});&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;});
}//&amp;nbsp;上面的这段js代码稍微有点复杂，愿大家耐心看！撸主是js菜鸡、文盲、白痴；大佬们勿喷！&lt;/pre&gt;&lt;pre class=&quot;hljs&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;ok！到此为止，整个流程就已经结束了！~上面的代码仅供参考！~下面撸主会贴出整套代码来造福社会!&lt;/pre&gt;&lt;blockquote style=&quot;box-sizing: border-box; padding: 10.5px 21px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; white-space: normal;&quot;&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;原装进口代码，麻烦大家记得点赞、关注、收藏，谢谢！&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;此套代码是原生的php！大家随意用！&lt;/p&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;调取支付页面代码&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs xml&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;lt;div&amp;nbsp;class=&amp;quot;goods_btn&amp;quot;&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;div&amp;nbsp;class=&amp;quot;buy&amp;quot;&amp;nbsp;onclick=&amp;quot;GetPay()&amp;quot;&amp;gt;立即购买&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;script&amp;nbsp;type=&amp;quot;text/javascript&amp;quot;&amp;gt;//接入微信扫码支付function&amp;nbsp;GetPay()&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//用ajax获取到支付的二维码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;payQrcode&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;payPrice&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;payOrderCode&amp;nbsp;=&amp;nbsp;&amp;#39;&amp;#39;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$.get(&amp;#39;/getPayQrcode.php&amp;#39;,{&amp;quot;goodsId&amp;quot;:&amp;quot;&amp;lt;?php&amp;nbsp;echo&amp;nbsp;$goodsInfo-&amp;gt;id;?&amp;gt;&amp;quot;},function(ret){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;obj&amp;nbsp;=&amp;nbsp;JSON.parse(ret)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(obj.status&amp;nbsp;==&amp;nbsp;&amp;#39;success&amp;#39;)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;payQrcode&amp;nbsp;=&amp;nbsp;&amp;#39;http://www.baidu.com&amp;#39;+obj.msg;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;payPrice&amp;nbsp;=&amp;nbsp;obj.price;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;payOrderCode&amp;nbsp;=&amp;nbsp;obj.code;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;layer.open({
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;type:&amp;nbsp;1,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;skin:&amp;nbsp;&amp;#39;layui-layer-demo&amp;#39;,&amp;nbsp;//样式类名
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;closeBtn:&amp;nbsp;0,&amp;nbsp;//不显示关闭按钮
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;title:false,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;anim:&amp;nbsp;2,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;area:&amp;nbsp;[&amp;#39;300px&amp;#39;,&amp;nbsp;&amp;#39;450px&amp;#39;],
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;shadeClose:&amp;nbsp;true,&amp;nbsp;//开启遮罩关闭
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;content:&amp;nbsp;&amp;#39;&amp;lt;div&amp;nbsp;style=&amp;quot;color:&amp;nbsp;#666;margin:&amp;nbsp;5px&amp;nbsp;0&amp;nbsp;0&amp;nbsp;10px;position:&amp;nbsp;absolute;right:.5rem;&amp;quot;&amp;nbsp;onclick=&amp;quot;layer.closeAll()&amp;quot;&amp;gt;X&amp;lt;/div&amp;gt;&amp;#39;+&amp;#39;&amp;lt;div&amp;nbsp;style=&amp;quot;text-align:&amp;nbsp;center;&amp;quot;&amp;gt;&amp;lt;img&amp;nbsp;style=&amp;quot;width:&amp;nbsp;4rem;padding:2rem&amp;nbsp;0&amp;nbsp;1rem&amp;nbsp;0;&amp;quot;&amp;nbsp;src=&amp;quot;./images/wx.png&amp;quot;&amp;nbsp;alt=&amp;quot;&amp;quot;&amp;nbsp;/&amp;gt;&amp;lt;br&amp;gt;&amp;lt;b&amp;nbsp;style=&amp;quot;font-weight:&amp;nbsp;100;color:&amp;nbsp;#888;&amp;quot;&amp;gt;请打开微信&amp;nbsp;扫码进行支付&amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;div&amp;nbsp;class=&amp;quot;blank&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;支付金额：&amp;lt;span&amp;nbsp;style=&amp;quot;color:&amp;nbsp;red;&amp;quot;&amp;gt;&amp;#39;+payPrice+&amp;#39;&amp;lt;/span&amp;gt;&amp;nbsp;元&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;class=&amp;quot;blank&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;+&amp;#39;&amp;lt;div&amp;nbsp;style=&amp;quot;text-align:&amp;nbsp;center&amp;quot;&amp;gt;&amp;lt;img&amp;nbsp;src=&amp;quot;&amp;#39;+payQrcode+&amp;#39;&amp;quot;&amp;nbsp;class=&amp;quot;resize&amp;quot;&amp;nbsp;style=&amp;quot;width:70%;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;id=&amp;quot;myDiv&amp;quot;&amp;nbsp;style=&amp;quot;width:&amp;nbsp;100%;height:&amp;nbsp;1.5rem;bottom:&amp;nbsp;2rem;position:absolute;text-align:center;font-size:&amp;nbsp;1.2rem;color:&amp;nbsp;#04BE02;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;id=&amp;quot;timer&amp;quot;&amp;nbsp;style=&amp;quot;display:none;&amp;quot;&amp;gt;0&amp;lt;/div&amp;gt;&amp;#39;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;});&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;设置每隔1000毫秒执行一次load()&amp;nbsp;方法&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;myIntval=setInterval(function(){load()},1000);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;load(){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//document.getElementById(&amp;quot;timer&amp;quot;).innerHTML=parseInt(document.getElementById(&amp;quot;timer&amp;quot;).innerHTML)+1;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;xmlhttp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(window.XMLHttpRequest){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE7+,&amp;nbsp;Firefox,&amp;nbsp;Chrome,&amp;nbsp;Opera,&amp;nbsp;Safari&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;XMLHttpRequest();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE6,&amp;nbsp;IE5&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;ActiveXObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.onreadystatechange=function(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(xmlhttp.readyState==4&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;xmlhttp.status==200){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;trade_state=JSON.parse(xmlhttp.responseText);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;console.log(trade_state);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(trade_state.code==&amp;#39;SUCCESS&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付成功&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//alert(transaction_id);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//延迟3000毫秒执行tz()&amp;nbsp;方法
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;setTimeout(&amp;quot;location.href=&amp;#39;./&amp;quot;,1500);&amp;nbsp;&amp;nbsp;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;REFUND&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;转入退款&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;NOTPAY&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;请扫码支付&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;CLOSED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已关闭&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;REVOKED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已撤销&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;USERPAYING&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;用户支付中&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state.code==&amp;#39;PAYERROR&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付失败&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//orderquery.php&amp;nbsp;文件返回订单状态，通过订单状态确定支付状态&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.open(&amp;quot;POST&amp;quot;,&amp;quot;http://www.baidu.com/payment/example/orderquery.php&amp;quot;,false);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//下面这句话必须有&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//把标签/值对添加到要发送的头文件。&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.setRequestHeader(&amp;quot;Content-type&amp;quot;,&amp;quot;application/x-www-form-urlencoded&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.send(&amp;quot;out_trade_no=&amp;quot;+payOrderCode+&amp;quot;&amp;quot;);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;layer.msg(&amp;#39;请求失败！&amp;#39;,&amp;nbsp;{icon:&amp;nbsp;5});&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;});
}&amp;lt;/script&amp;gt;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;获取二维码页面代码(此文件需要根据自身情况进行小小的修改！) getPayQrcode.php&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs php&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;//&amp;nbsp;放入老衲前不久写的curl函数&amp;nbsp;用curl方法获取二维码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;curlGet($url)&amp;nbsp;{&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$ch&amp;nbsp;=&amp;nbsp;curl_init();&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_URL,&amp;nbsp;$url);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_RETURNTRANSFER,&amp;nbsp;1);&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_HEADER,&amp;nbsp;false);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curl_setopt($ch,&amp;nbsp;CURLOPT_FOLLOWLOCATION,&amp;nbsp;1);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;curl_exec($ch);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;正式流程开始&amp;nbsp;返回的二维码是带信息的，所以需要先接收商品信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;比如:我是get过来商品的id，而后再进行查询数据库；这里大家随意；
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$goodsId&amp;nbsp;=&amp;nbsp;$_GET[&amp;#39;goodsId&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;利用商品ID查询到商品名称和价格
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$goodsName&amp;nbsp;=&amp;nbsp;&amp;#39;好日子牌姨妈巾&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$goodsPrice&amp;nbsp;=&amp;nbsp;&amp;#39;250&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;下面构造请求二维码的链接（由于是获取二维码支付，所以咋们请求的是native.php;后面会对该文件进行详细讲解）
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$url&amp;nbsp;=&amp;nbsp;&amp;#39;http://www.baidu.com/payment/example/native.php?goodsName=&amp;#39;.$goodsName.&amp;#39;&amp;amp;goodsPrice=&amp;#39;.goodsPrice;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;执行curlGet()函数
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$data&amp;nbsp;=&amp;nbsp;curlGet($url);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;preg_match_all函数进行全局正则表达式匹配,获取到二维码的链接。&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;preg_match(&amp;#39;/&amp;lt;\\s*img\\s+[^&amp;gt;]*?src\\s*=\\s*(\\&amp;#39;|\\&amp;quot;)(.*?)\\\\1[^&amp;gt;]*?\\/?\\s*&amp;gt;/i&amp;#39;,$data,$matches);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;preg_match(&amp;#39;/\\|\\|(.*)\\|\\|/&amp;#39;,$matches[0],$aac);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;构造返回信息
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;status&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;#39;success&amp;#39;;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;code&amp;#39;]&amp;nbsp;=&amp;nbsp;$aac[1];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;此值为返回交易码【用来确认订单支付状态的】
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;price&amp;#39;]&amp;nbsp;=&amp;nbsp;$goodsPrice;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$obj[&amp;#39;msg&amp;#39;]&amp;nbsp;=&amp;nbsp;&amp;#39;/payment/example/&amp;#39;.$matches[&amp;#39;2&amp;#39;];&amp;nbsp;//&amp;nbsp;请求返回的二维码
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;json_encode($obj);//&amp;nbsp;返回json&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;微信支付demo中的扫码支付文件 payment/example/native.php&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre class=&quot;hljs xml&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;lt;?phpini_set(&amp;#39;date.timezone&amp;#39;,&amp;#39;Asia/Shanghai&amp;#39;);//error_reporting(E_ERROR);require_once&amp;nbsp;&amp;quot;../lib/WxPay.Api.php&amp;quot;;require_once&amp;nbsp;&amp;quot;WxPay.NativePay.php&amp;quot;;require_once&amp;nbsp;&amp;#39;log.php&amp;#39;;//模式一/**
&amp;nbsp;*&amp;nbsp;流程：
&amp;nbsp;*&amp;nbsp;1、组装包含支付信息的url，生成二维码
&amp;nbsp;*&amp;nbsp;2、用户扫描二维码，进行支付
&amp;nbsp;*&amp;nbsp;3、确定支付之后，微信服务器会回调预先配置的回调地址，在【微信开放平台-微信支付-支付配置】中进行配置
&amp;nbsp;*&amp;nbsp;4、在接到回调通知之后，用户进行统一下单支付，并返回支付信息以完成支付（见：native_notify.php）
&amp;nbsp;*&amp;nbsp;5、支付完成之后，微信服务器会通知支付成功
&amp;nbsp;*&amp;nbsp;6、在支付成功通知中需要查单确认是否真正支付成功（见：notify.php）
&amp;nbsp;*/$notify&amp;nbsp;=&amp;nbsp;new&amp;nbsp;NativePay();$url1&amp;nbsp;=&amp;nbsp;$notify-&amp;gt;GetPrePayUrl(&amp;quot;123456789&amp;quot;);$goodsPrice&amp;nbsp;=&amp;nbsp;$_GET[&amp;#39;goodsPrice&amp;#39;];$goodsName&amp;nbsp;=&amp;nbsp;$_GET[&amp;#39;goodsName&amp;#39;];//&amp;nbsp;print_r($goodsPrice);die;//模式二/**
&amp;nbsp;*&amp;nbsp;流程：
&amp;nbsp;*&amp;nbsp;1、调用统一下单，取得code_url，生成二维码
&amp;nbsp;*&amp;nbsp;2、用户扫描二维码，进行支付
&amp;nbsp;*&amp;nbsp;3、支付完成之后，微信服务器会通知支付成功
&amp;nbsp;*&amp;nbsp;4、在支付成功通知中需要查单确认是否真正支付成功（见：notify.php）
&amp;nbsp;*/$input&amp;nbsp;=&amp;nbsp;new&amp;nbsp;WxPayUnifiedOrder();$input-&amp;gt;SetBody($goodsName);$input-&amp;gt;SetAttach(&amp;quot;今知商城&amp;quot;);$num&amp;nbsp;=&amp;nbsp;WxPayConfig::MCHID.date(&amp;quot;YmdHis&amp;quot;);$input-&amp;gt;SetOut_trade_no($num);$input-&amp;gt;SetTotal_fee($goodsPrice*100);$input-&amp;gt;SetTime_start(date(&amp;quot;YmdHis&amp;quot;));$input-&amp;gt;SetTime_expire(date(&amp;quot;YmdHis&amp;quot;,&amp;nbsp;time()&amp;nbsp;+&amp;nbsp;600));$input-&amp;gt;SetGoods_tag($goodsName);$input-&amp;gt;SetNotify_url(&amp;quot;/payment/example/notify.php&amp;quot;);$input-&amp;gt;SetTrade_type(&amp;quot;NATIVE&amp;quot;);$input-&amp;gt;SetProduct_id(&amp;quot;123456789&amp;quot;);$result&amp;nbsp;=&amp;nbsp;$notify-&amp;gt;GetPayUrl($input);//echo&amp;nbsp;&amp;quot;&amp;lt;pre&amp;gt;&amp;quot;;//print_r($result);$url2&amp;nbsp;=&amp;nbsp;$result[&amp;quot;code_url&amp;quot;];?&amp;gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;meta&amp;nbsp;http-equiv=&amp;quot;content-type&amp;quot;&amp;nbsp;content=&amp;quot;text/html;charset=utf-8&amp;quot;/&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;meta&amp;nbsp;name=&amp;quot;viewport&amp;quot;&amp;nbsp;content=&amp;quot;width=device-width,&amp;nbsp;initial-scale=1&amp;quot;&amp;nbsp;/&amp;gt;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;title&amp;gt;微信支付样例&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;div&amp;nbsp;style=&amp;quot;margin-left:&amp;nbsp;10px;color:#556B2F;font-size:30px;font-weight:&amp;nbsp;bolder;&amp;quot;&amp;gt;扫描支付模式二&amp;lt;/div&amp;gt;&amp;lt;br/&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;img&amp;nbsp;alt=&amp;quot;||&amp;lt;?php&amp;nbsp;echo&amp;nbsp;$num?&amp;gt;||&amp;quot;&amp;nbsp;src=&amp;quot;qrcode.php?data=&amp;lt;?php&amp;nbsp;echo&amp;nbsp;urlencode($url2);?&amp;gt;&amp;quot;&amp;nbsp;style=&amp;quot;width:150px;height:150px;&amp;quot;/&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;div&amp;nbsp;id=&amp;quot;myDiv&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;nbsp;id=&amp;quot;timer&amp;quot;&amp;gt;0&amp;lt;/div&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;script&amp;gt;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//设置每隔1000毫秒执行一次load()&amp;nbsp;方法&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;myIntval=setInterval(function(){load()},1000);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;load(){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;timer&amp;quot;).innerHTML=parseInt(document.getElementById(&amp;quot;timer&amp;quot;).innerHTML)+1;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;xmlhttp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(window.XMLHttpRequest){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE7+,&amp;nbsp;Firefox,&amp;nbsp;Chrome,&amp;nbsp;Opera,&amp;nbsp;Safari&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;XMLHttpRequest();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;code&amp;nbsp;for&amp;nbsp;IE6,&amp;nbsp;IE5&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp=new&amp;nbsp;ActiveXObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.onreadystatechange=function(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(xmlhttp.readyState==4&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;xmlhttp.status==200){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;trade_state=xmlhttp.responseText;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(trade_state==&amp;#39;SUCCESS&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付成功&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//alert(transaction_id);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//延迟3000毫秒执行tz()&amp;nbsp;方法
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;setTimeout(&amp;quot;location.href=&amp;#39;success.php&amp;#39;&amp;quot;,3000);&amp;nbsp;&amp;nbsp;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;REFUND&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;转入退款&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;NOTPAY&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;请扫码支付&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;CLOSED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已关闭&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;REVOKED&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;已撤销&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;USERPAYING&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;用户支付中&amp;#39;;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;if(trade_state==&amp;#39;PAYERROR&amp;#39;){&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;document.getElementById(&amp;quot;myDiv&amp;quot;).innerHTML=&amp;#39;支付失败&amp;#39;;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;clearInterval(myIntval);&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//orderquery.php&amp;nbsp;文件返回订单状态，通过订单状态确定支付状态&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.open(&amp;quot;POST&amp;quot;,&amp;quot;orderquery.php&amp;quot;,false);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//下面这句话必须有&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//把标签/值对添加到要发送的头文件。&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.setRequestHeader(&amp;quot;Content-type&amp;quot;,&amp;quot;application/x-www-form-urlencoded&amp;quot;);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xmlhttp.send(&amp;quot;out_trade_no=&amp;lt;?php&amp;nbsp;echo&amp;nbsp;$num;?&amp;gt;&amp;quot;);&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;/script&amp;gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;/body&amp;gt;&lt;/pre&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;&quot;&gt;微信支付demo 订单查询页面&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span class=&quot;selectCode code-tool&quot; data-toggle=&quot;tooltip&quot; data-placement=&quot;top&quot; title=&quot;&quot; data-original-title=&quot;全选&quot; style=&quot;box-sizing: border-box; cursor: pointer; display: block; float: left; background-image: url(&amp;quot;../img/codeTools.svg&amp;quot;); height: 16px; width: 16px; background-size: auto 16px; margin: 4px 5px; opacity: 0.5;&quot;&gt;&lt;/span&gt;&lt;span type=&quot;button&quot; class=&quot;copyCode code-tool&quot; data-toggle=&quot;tooltip&quot; data-placement=&quot;top&quot; data-clipboard-text=&quot;&amp;lt;?php
header(&amp;quot;Access-Control-Allow-Origin:*&amp;quot;); 
ini_set(&amp;#39;date.timezone&amp;#39;,&amp;#39;Asia/Shanghai&amp;#39;);
error_reporting(E_ERROR);
require_once &amp;quot;../lib/WxPay.Api.php&amp;quot;;
require_once &amp;#39;log.php&amp;#39;;
 
//初始化日志
$logHandler= new CLogFileHandler(&amp;quot;./logs/&amp;quot;.date(&amp;#39;Y-m-d&amp;#39;).&amp;#39;.log&amp;#39;);
$log = Log::Init($logHandler, 15);
 
function printf_info($data)
{
    foreach($data as $key=&amp;gt;$value){
        echo &amp;quot;&amp;lt;font color=&amp;#39;#f00;&amp;#39;&amp;gt;$key&amp;lt;/font&amp;gt; : $value &amp;lt;br/&amp;gt;&amp;quot;;
    }
}
 
 
if(isset($_REQUEST[&amp;quot;transaction_id&amp;quot;]) &amp;amp;&amp;amp; $_REQUEST[&amp;quot;transaction_id&amp;quot;] != &amp;quot;&amp;quot;){
    $transaction_id = $_REQUEST[&amp;quot;transaction_id&amp;quot;];
    $input = new WxPayOrderQuery();
    $input-&amp;gt;SetTransaction_id($transaction_id);
    //printf_info(WxPayApi::orderQuery($input));
    $result=WxPayApi::orderQuery($input);
    echo $result[&amp;#39;trade_state&amp;#39;];
    exit();
}
 
if(isset($_REQUEST[&amp;quot;out_trade_no&amp;quot;]) &amp;amp;&amp;amp; $_REQUEST[&amp;quot;out_trade_no&amp;quot;] != &amp;quot;&amp;quot;){
    $out_trade_no = $_REQUEST[&amp;quot;out_trade_no&amp;quot;];
    $input = new WxPayOrderQuery();
    $input-&amp;gt;SetOut_trade_no($out_trade_no);
    //printf_info(WxPayApi::orderQuery($input));
    $result=WxPayApi::orderQuery($input);
    $status[&amp;#39;code&amp;#39;] =  $result[&amp;#39;trade_state&amp;#39;];
    $status[&amp;#39;openid&amp;#39;] =  $result[&amp;#39;openid&amp;#39;];
    $status[&amp;#39;total_fee&amp;#39;] =  $result[&amp;#39;total_fee&amp;#39;];
    $status[&amp;#39;transaction_id&amp;#39;] =  $result[&amp;#39;transaction_id&amp;#39;];
    $status[&amp;#39;time&amp;#39;] =  $result[&amp;#39;time_end&amp;#39;];
    //print_r($result);
    print_r(json_encode($status));
    exit();
}
?&amp;gt;
&quot; title=&quot;&quot; data-original-title=&quot;复制&quot; style=&quot;box-sizing: border-box; cursor: pointer; display: block; float: left; background-image: url(&amp;quot;../img/codeTools.svg&amp;quot;); height: 16px; width: 16px; background-size: auto 16px; margin: 4px 5px; opacity: 0.5; background-position: -16px 0px !important;&quot;&gt;&lt;/span&gt;&lt;span type=&quot;button&quot; class=&quot;saveToNote code-tool&quot; data-toggle=&quot;tooltip&quot; data-placement=&quot;top&quot; title=&quot;&quot; data-original-title=&quot;放进笔记&quot; style=&quot;box-sizing: border-box; cursor: pointer; display: block; float: left; background-image: url(&amp;quot;../img/codeTools.svg&amp;quot;); height: 16px; width: 16px; background-size: auto 16px; margin: 4px 5px; opacity: 0.5; background-position: -31px 0px !important;&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;pre class=&quot;hljs xml&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;lt;?phpheader(&amp;quot;Access-Control-Allow-Origin:*&amp;quot;);&amp;nbsp;
ini_set(&amp;#39;date.timezone&amp;#39;,&amp;#39;Asia/Shanghai&amp;#39;);
error_reporting(E_ERROR);require_once&amp;nbsp;&amp;quot;../lib/WxPay.Api.php&amp;quot;;require_once&amp;nbsp;&amp;#39;log.php&amp;#39;;&amp;nbsp;
//初始化日志$logHandler=&amp;nbsp;new&amp;nbsp;CLogFileHandler(&amp;quot;./logs/&amp;quot;.date(&amp;#39;Y-m-d&amp;#39;).&amp;#39;.log&amp;#39;);$log&amp;nbsp;=&amp;nbsp;Log::Init($logHandler,&amp;nbsp;15);&amp;nbsp;
function&amp;nbsp;printf_info($data){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;foreach($data&amp;nbsp;as&amp;nbsp;$key=&amp;gt;$value){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;&amp;quot;&amp;lt;font&amp;nbsp;color=&amp;#39;#f00;&amp;#39;&amp;gt;$key&amp;lt;/font&amp;gt;&amp;nbsp;:&amp;nbsp;$value&amp;nbsp;&amp;lt;br/&amp;gt;&amp;quot;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&amp;nbsp;
&amp;nbsp;
if(isset($_REQUEST[&amp;quot;transaction_id&amp;quot;])&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;$_REQUEST[&amp;quot;transaction_id&amp;quot;]&amp;nbsp;!=&amp;nbsp;&amp;quot;&amp;quot;){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$transaction_id&amp;nbsp;=&amp;nbsp;$_REQUEST[&amp;quot;transaction_id&amp;quot;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$input&amp;nbsp;=&amp;nbsp;new&amp;nbsp;WxPayOrderQuery();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$input-&amp;gt;SetTransaction_id($transaction_id);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//printf_info(WxPayApi::orderQuery($input));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$result=WxPayApi::orderQuery($input);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$result[&amp;#39;trade_state&amp;#39;];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;exit();
}&lt;/pre&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489586356') [ RunTime:0.2311s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000041s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000106s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.138914s ]
INFO: [ view_parse ] --END-- [ RunTime:0.138994s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000246s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000277s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0326s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0257s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000077s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.196978s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.138247s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.059199s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000010s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.197209s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.024592s ]
INFO: [ app_end ] --END-- [ RunTime:0.024704s ]

[ 2017-03-15T21:59:20+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000014s ]
INFO: [ app_init ] --END-- [ RunTime:0.000416s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000403s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000456s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0265s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0263s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000080s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000154s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.247811s ]
INFO: [ view_parse ] --END-- [ RunTime:0.247871s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000229s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000252s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.048646s ]
INFO: [ app_end ] --END-- [ RunTime:0.048703s ]

[ 2017-03-15T21:59:58+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000018s ]
INFO: [ app_init ] --END-- [ RunTime:0.000427s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.047778s ]
INFO: [ app_begin ] --END-- [ RunTime:0.047863s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0253s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES ('nginx配置ssl加密（单/双向认证、部分https）','3','nginx配置ssl加密（单/双向认证、部分https）','&lt;h1 id=&quot;articleHeader0&quot; style=&quot;box-sizing: border-box; font-size: 2.25em; margin: 1.5em 0px 0px; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); border-bottom: 1px solid rgb(238, 238, 238); padding-bottom: 10px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;1. 全站ssl&lt;/h1&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;全站做ssl是最常见的一个使用场景，默认端口443，而且一般是单向认证。&lt;/p&gt;&lt;pre class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;server&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;listen&amp;nbsp;443;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;server_name&amp;nbsp;example.com;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;root&amp;nbsp;/apps/www;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;index&amp;nbsp;index.html&amp;nbsp;index.htm;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl&amp;nbsp;on;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_certificate&amp;nbsp;../SSL/ittest.pem;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_certificate_key&amp;nbsp;../SSL/ittest.key;#&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_protocols&amp;nbsp;SSLv3&amp;nbsp;TLSv1&amp;nbsp;TLSv1.1&amp;nbsp;TLSv1.2;#&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_ciphers&amp;nbsp;ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;#&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_prefer_server_ciphers&amp;nbsp;on;}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;如果想把http的请求强制转到https的话：&lt;/p&gt;&lt;pre class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;server&amp;nbsp;{&amp;nbsp;&amp;nbsp;listen&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;80;&amp;nbsp;&amp;nbsp;server_name&amp;nbsp;example.me;&amp;nbsp;&amp;nbsp;rewrite&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;^&amp;nbsp;&amp;nbsp;&amp;nbsp;https://$server_name$request_uri?&amp;nbsp;permanent;###&amp;nbsp;使用return的效率会更高&amp;nbsp;#&amp;nbsp;&amp;nbsp;return&amp;nbsp;301&amp;nbsp;https://$server_name$request_uri;}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_certificate&lt;/code&gt;证书其实是个公钥，它会被发送到连接服务器的每个客户端，&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_certificate_key&lt;/code&gt;私钥是用来解密的，所以它的权限要得到保护但nginx的主进程能够读取。当然私钥和证书可以放在一个证书文件中，这种方式也只有公钥证书才发送到client。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_protocols&lt;/code&gt;指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2&lt;/code&gt;，TLSv1.1与TLSv1.2要确保OpenSSL &amp;gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_ciphers&lt;/code&gt;选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。这里指定的是OpenSSL库能够识别的写法，你可以通过&amp;nbsp;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;openssl -v cipher &amp;#39;RC4:HIGH:!aNULL:!MD5&amp;#39;&lt;/code&gt;（后面是你所指定的套件加密算法） 来看所支持算法。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_prefer_server_ciphers on&lt;/code&gt;设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。&lt;/p&gt;&lt;h2 id=&quot;articleHeader1&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.75em; border-bottom: 1px solid rgb(238, 238, 238); padding-bottom: 10px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;https优化参数&lt;/h2&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_session_cache shared:SSL:10m;&lt;/code&gt;&amp;nbsp;: 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;shared&lt;/code&gt;，&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;buildin&lt;/code&gt;可能会参数内存碎片，默认是&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;none&lt;/code&gt;，和&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;off&lt;/code&gt;差不多，停用缓存。如&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;shared:SSL:10m&lt;/code&gt;表示我所有的nginx工作进程共享ssl会话缓存，官网介绍说1M可以存放约4000个sessions。 详细参考serverfault上的问答&lt;a rel=&quot;nofollow&quot; href=&quot;http://serverfault.com/questions/695258/when-shoud-i-use-ssl-session-cache-paramter-in-nginx-ssl-settings&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;ssl_session_cache&lt;/a&gt;。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ssl_session_timeout&lt;/code&gt;&amp;nbsp;： 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;30m&lt;/code&gt;即30分钟甚至&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;4h&lt;/code&gt;。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;设置较长的&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;keepalive_timeout&lt;/code&gt;也可以减少请求ssl会话协商的开销，但同时得考虑线程的并发数了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;提示&lt;/span&gt;：在生成证书请求csr文件时，如果输入了密码，nginx每次启动时都会提示输入这个密码，可以使用私钥来生成解密后的key来代替，效果是一样的，达到免密码重启的效果：&lt;/p&gt;&lt;pre class=&quot;hljs cs&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;openssl&amp;nbsp;rsa&amp;nbsp;-in&amp;nbsp;ittest.key&amp;nbsp;-out&amp;nbsp;ittest_unsecure.key&lt;/pre&gt;&lt;h2 id=&quot;articleHeader2&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.75em; border-bottom: 1px solid rgb(238, 238, 238); padding-bottom: 10px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;导入证书&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;如果你是找一个知名的ssl证书颁发机构如VeriSign、Wosign、StartSSL签发的证书，浏览器已经内置并信任了这些根证书，如果你是自建C或获得二级CA授权，都需要将CA证书添加到浏览器，这样在访问站点时才不会显示不安全连接。各个浏览的添加方法不在本文探讨范围内。&lt;/p&gt;&lt;h1 id=&quot;articleHeader3&quot; style=&quot;box-sizing: border-box; font-size: 2.25em; margin: 1.5em 0px 0px; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); border-bottom: 1px solid rgb(238, 238, 238); padding-bottom: 10px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;2. 部分页面ssl&lt;/h1&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;一个站点并不是所有信息都是非常机密的，如网上商城，一般的商品浏览可以不通过https，而用户登录以及支付的时候就强制经过https传输，这样用户访问速度和安全性都得到兼顾。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;但是请注意不要理解错了，是对页面加密而不能针对某个请求加密，一个页面或地址栏的URL一般会发起许多请求的，包括css/png/js等静态文件和动态的java或php请求，所以要加密的内容包含页面内的其它资源文件，否则就会出现http与https内容混合的问题。在http页面混有https内容时，页面排版不会发生乱排现象；在https页面中包含以http方式引入的图片、js等资源时，浏览器为了安全起见会阻止加载。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;下面是只对&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;example.com/account/login&lt;/code&gt;登录页面进行加密的栗子：&lt;/p&gt;&lt;pre class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;root&amp;nbsp;/apps/www;index&amp;nbsp;index.html&amp;nbsp;index.htm;server&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;listen&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;80;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;server_name&amp;nbsp;example.com;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;location&amp;nbsp;^~&amp;nbsp;/account/login&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;rewrite&amp;nbsp;^&amp;nbsp;https://$server_name:443$request_uri?&amp;nbsp;permanent;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;location&amp;nbsp;/&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_pass&amp;nbsp;&amp;nbsp;http://localhost:8080;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;###&amp;nbsp;Set&amp;nbsp;headers&amp;nbsp;####
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;Host&amp;nbsp;$host;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;X-Real-IP&amp;nbsp;$remote_addr;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;X-Forwarded-For&amp;nbsp;$proxy_add_x_forwarded_for;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_redirect&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;off;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}server&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;listen&amp;nbsp;443&amp;nbsp;ssl;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;server_name&amp;nbsp;example.com;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl&amp;nbsp;on;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_certificate&amp;nbsp;../SSL/ittest.pem;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_certificate_key&amp;nbsp;../SSL/ittest.key;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_protocols&amp;nbsp;SSLv3&amp;nbsp;TLSv1&amp;nbsp;TLSv1.1&amp;nbsp;TLSv1.2;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_ciphers&amp;nbsp;ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_prefer_server_ciphers&amp;nbsp;on;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;location&amp;nbsp;^~&amp;nbsp;/account/login&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_pass&amp;nbsp;&amp;nbsp;http://localhost:8080;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;Host&amp;nbsp;$host;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;X-Real-IP&amp;nbsp;$remote_addr;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;X-Forwarded-For&amp;nbsp;$proxy_add_x_forwarded_for;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_redirect&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;off;&amp;nbsp;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;###&amp;nbsp;Most&amp;nbsp;PHP,&amp;nbsp;Python,&amp;nbsp;Rails,&amp;nbsp;Java&amp;nbsp;App&amp;nbsp;can&amp;nbsp;use&amp;nbsp;this&amp;nbsp;header&amp;nbsp;-&amp;gt;&amp;nbsp;https&amp;nbsp;###
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;X-Forwarded-Proto&amp;nbsp;&amp;nbsp;$scheme;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;location&amp;nbsp;/&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;rewrite&amp;nbsp;&amp;nbsp;^&amp;nbsp;&amp;nbsp;http://$server_name$request_uri?&amp;nbsp;permanent;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;关于rewrite与location的写法参考&lt;a rel=&quot;nofollow&quot; href=&quot;http://segmentfault.com/a/1190000002797606&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;这里&lt;/a&gt;。当浏览器访问&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;http://example.com/account/login.xx&lt;/code&gt;时，被301到&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;https://example.com/account/login.xx&lt;/code&gt;，在这个ssl加密的虚拟主机里也匹配到&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;/account/login&lt;/code&gt;，反向代理到后端服务器，后面的传输过程是没有https的。这个login.xx页面下的其它资源也是经过https请求nginx的，登录成功后跳转到首页时的链接使用http，这个可能需要开发代码里面控制。&lt;/p&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;上面配置中使用了&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;proxy_set_header X-Forwarded-Proto $scheme&lt;/code&gt;，在jsp页面使用&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;request.getScheme()&lt;/code&gt;得到的是https 。如果不把请求的$scheme协议设置在header里，后端jsp页面会一直认为是http，将导致响应异常。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ssl配置块还有个与不加密的80端口类似的&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;location /&lt;/code&gt;，它的作用是当用户直接通过https访问首页时，自动跳转到不加密端口，你可以去掉它允许用户这样做。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 id=&quot;articleHeader4&quot; style=&quot;box-sizing: border-box; font-size: 2.25em; margin: 1.5em 0px 0px; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); border-bottom: 1px solid rgb(238, 238, 238); padding-bottom: 10px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;3. 实现双向ssl认证&lt;/h1&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;上面的两种配置都是去认证被访问的站点域名是否真实可信，并对传输过程加密，但服务器端并没有认证客户端是否可信。（实际上除非特别重要的场景，也没必要去认证访问者，除非像银行U盾这样的情况）&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;要实现双向认证HTTPS，nginx服务器上必须导入CA证书（根证书/中间级证书），因为现在是由服务器端通过CA去验证客户端的信息。还有必须在申请服务器证书的同时，用同样的方法生成客户证书。取得客户证书后，还要将它转换成浏览器识别的格式（大部分浏览器都认识PKCS12格式）：&lt;/p&gt;&lt;pre class=&quot;hljs objectivec&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;openssl&amp;nbsp;pkcs12&amp;nbsp;-export&amp;nbsp;-clcerts&amp;nbsp;-in&amp;nbsp;client.crt&amp;nbsp;-inkey&amp;nbsp;client.key&amp;nbsp;-out&amp;nbsp;client.p12&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;然后把这个&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;client.p12&lt;/code&gt;发给你相信的人，让它导入到浏览器中，访问站点建立连接的时候nginx会要求客户端把这个证书发给自己验证，如果没有这个证书就拒绝访问。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;同时别忘了在 nginx.conf 里配置信任的CA：（如果是二级CA，请把根CA放在后面，形成CA证书链）&lt;/p&gt;&lt;pre class=&quot;hljs coffeescript&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_ignore_client_abort&amp;nbsp;on；

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl&amp;nbsp;on;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_verify_client&amp;nbsp;on;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_verify_depth&amp;nbsp;2;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ssl_client_certificate&amp;nbsp;../SSL/ca-chain.pem;#在双向location下加入：
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy_set_header&amp;nbsp;X-SSL-Client-Cert&amp;nbsp;$ssl_client_cert;&lt;/pre&gt;&lt;h2 id=&quot;articleHeader5&quot; style=&quot;box-sizing: border-box; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-weight: 500; line-height: 1.2; color: rgb(51, 51, 51); margin: 1.5em 0px 0px; font-size: 1.75em; border-bottom: 1px solid rgb(238, 238, 238); padding-bottom: 10px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;拓展：使用geo模块&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;nginx默认安装了一个&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;ngx_http_geo_module&lt;/code&gt;，这个geo模块可以根据客户端IP来创建变量的值，用在如来自172.29.73.0/24段的IP访问login时使用双向认证，其它段使用一般的单向认证。&lt;/p&gt;&lt;pre class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;geo&amp;nbsp;$duplexing_user&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;default&amp;nbsp;1;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;include&amp;nbsp;geo.conf;&amp;nbsp;&amp;nbsp;#&amp;nbsp;注意在0.6.7版本以后，include是相对于nginx.conf所在目录而言的}&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;语法&amp;nbsp;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;geo [$address] $variable { … }&lt;/code&gt;，位于http段，默认地址是&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;$reoute_addr&lt;/code&gt;，假设&amp;nbsp;&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;conf/geo.conf&lt;/code&gt;&amp;nbsp;内容：&lt;/p&gt;&lt;pre class=&quot;hljs coffeescript&quot; style=&quot;box-sizing: border-box; overflow: auto; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.3; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 3px; max-height: 35em; position: relative; margin-top: 0px !important;&quot;&gt;127.0.0.1/32&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;LOCAL;&amp;nbsp;&amp;nbsp;#&amp;nbsp;本地172.29.73.23/32&amp;nbsp;SEAN;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&amp;nbsp;某个IP172.29.73.0/24&amp;nbsp;&amp;nbsp;1;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&amp;nbsp;IP段，可以按国家或地域定义后面的不同的值&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;需要配置另外一个虚拟主机server{ssl 445}，里面使用上面双向认证的写法，然后在80或443里使用变量&lt;code style=&quot;box-sizing: border-box; font-family: &amp;quot;Source Code Pro&amp;quot;, Consolas, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.93em; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); padding: 2px 4px; border-radius: 3px;&quot;&gt;$duplexing_user&lt;/code&gt;去判断，如果为1就rewrite到445，否则rewrite到443。具体用法可以参考&lt;a rel=&quot;nofollow&quot; href=&quot;http://www.ttlsa.com/nginx/using-nginx-geo-method/&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;nginx geo使用方法&lt;/a&gt;。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;box-sizing: border-box; font-weight: 700;&quot;&gt;参考&lt;/span&gt;&lt;/p&gt;&lt;ul style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; margin-left: 3em; padding-left: 0px; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;http://blog.csdn.net/na_tion/article/details/17334669&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;Nginx部署部分https与部分http&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;https://www.zhoufengjie.cn/?p=185&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;Linux+Nginx/Apache/Tomcat新增SSL证书，开启https访问教程&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;https://www.sinosky.org/ssl-and-spdy-enabled.html&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;SSL &amp;amp; SPDY 已全面部署&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;http://han.guokai.blog.163.com/blog/static/136718271201211631456811/&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;SSL证书与Https应用部署小结&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;http://nginx.org/en/docs/http/ngx_http_ssl_module.html&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;ngx_http_ssl_module docs&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;https://bjornjohansen.no/optimizing-https-nginx&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;Optimizing HTTPS on Nginx&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;http://zhangge.net/4861.html&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;http://zhangge.net/4861.html&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a rel=&quot;nofollow&quot; href=&quot;http://blog.chinaunix.net/uid-192074-id-3135733.html&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;http://blog.chinaunix.net/uid-192074-id-3135733.html&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr style=&quot;box-sizing: content-box; height: 0px; margin: 1.5em auto; border-width: 2px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: dotted; border-top-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;/&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;原文链接地址：&lt;a rel=&quot;nofollow&quot; href=&quot;http://seanlook.com/2015/05/28/nginx-ssl/&quot; target=&quot;_blank&quot; style=&quot;box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px;&quot;&gt;http://seanlook.com/2015/05/28/nginx-ssl/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489586397') [ RunTime:0.1116s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000051s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000134s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.215863s ]
INFO: [ view_parse ] --END-- [ RunTime:0.215936s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000193s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000220s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0305s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0249s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000089s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.192200s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.140121s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.056168s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000010s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.196112s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000616s ]
INFO: [ app_end ] --END-- [ RunTime:0.000707s ]

[ 2017-03-15T22:00:01+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.044550s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.048627s ]
INFO: [ app_begin ] --END-- [ RunTime:0.048689s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0251s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0248s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000105s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000188s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.209692s ]
INFO: [ view_parse ] --END-- [ RunTime:0.209731s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.046314s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046383s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000512s ]
INFO: [ app_end ] --END-- [ RunTime:0.000540s ]

[ 2017-03-15T22:02:09+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000014s ]
INFO: [ app_init ] --END-- [ RunTime:0.000361s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000409s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000469s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0264s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES ('Nginx 反向代理','3','Nginx 反向代理','&lt;p&gt;#负责压缩数据流&lt;/p&gt;&lt;p&gt;gzip &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;on; &amp;nbsp;&lt;/p&gt;&lt;p&gt;gzip_min_length &amp;nbsp; 1000; &amp;nbsp;&lt;/p&gt;&lt;p&gt;gzip_types &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;text/plain text/css application/x-javascript;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;#设定负载均衡的服务器列表&lt;/p&gt;&lt;p&gt;#weigth参数表示权值，权值越高被分配到的几率越大&lt;/p&gt;&lt;p&gt;upstream hello{&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; server 192.168.68.43:8080 weight=1;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; server 192.168.68.45:8080 weight=1; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/p&gt;&lt;p&gt;}&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp;&lt;/p&gt;&lt;p&gt;server {&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; #侦听的80端口&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; listen &amp;nbsp; &amp;nbsp; &amp;nbsp; 80;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; server_name &amp;nbsp;localhost;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; #设定查看Nginx状态的地址&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; location /nginxstatus{&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;stub_status on;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;access_log on;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;auth_basic &amp;quot;nginxstatus&amp;quot;;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;auth_basic_user_file htpasswd;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; }&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; #匹配以jsp结尾的，tomcat的网页文件是以jsp结尾&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; location / {&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index index.jsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_pass &amp;nbsp; http://hello; &amp;nbsp; &amp;nbsp;#在这里设置一个代理，和upstream的名字一样&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; #以下是一些反向代理的配置可删除&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_redirect &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; off;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_set_header &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Host $host;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_set_header &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; X-Real-IP $remote_addr;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_set_header &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; X-Forwarded-For $proxy_add_x_forwarded_for;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; client_max_body_size &amp;nbsp; &amp;nbsp; &amp;nbsp; 10m; #允许客户端请求的最大单文件字节数&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; client_body_buffer_size &amp;nbsp; &amp;nbsp;128k; #缓冲区代理缓冲用户端请求的最大字节数&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_connect_timeout &amp;nbsp; &amp;nbsp; &amp;nbsp;300; #nginx跟后端服务器连接超时时间(代理连接超时)&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_send_timeout &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 300; #后端服务器数据回传时间(代理发送超时)&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_read_timeout &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 300; #连接成功后，后端服务器响应时间(代理接收超时)&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_buffer_size &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_buffers &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;4 32k; #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_busy_buffers_size &amp;nbsp; &amp;nbsp;64k; #高负荷下缓冲大小（proxy_buffers*2）&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; }&lt;/p&gt;&lt;p&gt;}&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489586528') [ RunTime:0.0860s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000048s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000129s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.183364s ]
INFO: [ view_parse ] --END-- [ RunTime:0.183453s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000207s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000246s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0433s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0278s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000081s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.209084s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.138433s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.071949s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000015s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.210198s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000563s ]
INFO: [ app_end ] --END-- [ RunTime:0.000644s ]

[ 2017-03-15T22:02:12+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.043569s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.008451s ]
INFO: [ app_begin ] --END-- [ RunTime:0.008552s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0265s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0261s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.046165s ]
INFO: [ template_filter ] --END-- [ RunTime:0.046286s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.256945s ]
INFO: [ view_parse ] --END-- [ RunTime:0.257013s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000253s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000284s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.046686s ]
INFO: [ app_end ] --END-- [ RunTime:0.046768s ]

[ 2017-03-15T22:03:35+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.046582s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.047664s ]
INFO: [ app_begin ] --END-- [ RunTime:0.047759s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0264s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES ('Nginx反向代理和负载均衡部署','3','Nginx反向代理和负载均衡部署','&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;1.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/strong&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;安装&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;1)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 从Nginx官网下载页面（&lt;a href=&quot;http://nginx.org/en/download.html&quot; style=&quot;margin: 0px; padding: 0px; color: black;&quot;&gt;http://nginx.org/en/download.html&lt;/a&gt;）下载Nginx最新版本（目前是1.5.13版本）安装包；&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;2)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 解压后复制到部署目录。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;2.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/strong&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;启动和停止&lt;/strong&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;Nginx&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;Nginx目前只支持命令行操作，操作前先进入Dos命令环境，并进入Nginx部署目录。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;1)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 启动Nginx：start nginx&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;2)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 停止Nginx：nginx -s stop&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;3)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 修改配置后重启：nginx -s reload&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;这三个命令可分别做成bat文件，放在部署目录下，方便后续操作。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;start nginx.bat文件内容：start nginx&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;stop nginx.bat文件内容：nginx -s stop&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;reload nginx.bat文件内容：nginx -s reload&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;3.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/strong&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;反向代理配置&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;修改部署目录下conf子目录的nginx.conf文件（如nginx-1.5.13\\conf\\nginx.conf）内容，可调整相关配置。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;反向代理配置示例：&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;location / {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; #设置主机头和客户端真实地址，以便服务器获取客户端真实IP&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_set_header Host $host;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_set_header X-Real-IP $remote_addr;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #禁用缓存&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_buffering off;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #设置反向代理的地址&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_pass http://192.168.1.1;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;代理地址根据实际情况修改。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;4.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/strong&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;负载均衡配置&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;nginx 的 upstream默认是以轮询的方式实现负载均衡，这种方式中，每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;另外一种方式是ip_hash：每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;负载均衡配置示例：&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;upstream backend {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #ip_hash;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; server 192.168.1.251;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; server 192.168.1.252;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; server 192.168.1.247;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;server {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; listen&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 80;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; server_name&amp;nbsp; trffweb;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; location / {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #反向代理的地址&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_pass http://backend;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;Upstream命名和服务器地址根据实际情况修改。&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;5.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/strong&gt;&lt;strong style=&quot;margin: 0px; padding: 0px;&quot;&gt;完整配置示例&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;nginx.conf：&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;worker_processes&amp;nbsp; 1;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;events {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; worker_connections&amp;nbsp; 1024;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;http {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; include&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mime.types;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; default_type&amp;nbsp; application/octet-stream;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sendfile&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; on;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; keepalive_timeout&amp;nbsp; 65;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; upstream backend {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #ip_hash;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; server 192.168.1.251;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; server 192.168.1.252;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; server 192.168.1.247;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; server {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; listen&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 80;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; server_name&amp;nbsp; 2;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; location / {&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; #设置主机头和客户端真实地址，以便服务器获取客户端真实IP&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_set_header Host $host;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_set_header X-Real-IP $remote_addr;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #禁用缓存&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_buffering off;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; #反向代理的地址&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; proxy_pass http://backend;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489586614') [ RunTime:0.0708s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000052s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000157s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.204726s ]
INFO: [ view_parse ] --END-- [ RunTime:0.204771s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.045384s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045453s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0326s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0287s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000101s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.197312s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.133385s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.107423s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000015s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.195432s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.012634s ]
INFO: [ app_end ] --END-- [ RunTime:0.012749s ]

[ 2017-03-15T22:03:38+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.046589s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000639s ]
INFO: [ app_begin ] --END-- [ RunTime:0.050788s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0261s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0258s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000099s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000176s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.332269s ]
INFO: [ view_parse ] --END-- [ RunTime:0.332346s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000216s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000253s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.050788s ]
INFO: [ app_end ] --END-- [ RunTime:0.050862s ]

[ 2017-03-15T22:08:20+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.009004s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.049675s ]
INFO: [ app_begin ] --END-- [ RunTime:0.049771s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0260s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES ('PHP 后端常见面试题及答案','1','PHP 后端常见面试题及答案','&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;基础题:&lt;br/&gt;1.表单中&amp;nbsp;get与post提交方法的区别?&lt;br/&gt;答:get是发送请求HTTP协议通过url参数传递进行接收,而post是实体数据,可以通过表单提交大量信息.&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;2.session与cookie的区别?&lt;br/&gt;答:session:储存用户访问的全局唯一变量,存储在服务器上的&lt;a href=&quot;http://lib.csdn.net/base/php&quot; class=&quot;replace_word&quot; title=&quot;PHP知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;PHP&lt;/a&gt;指定的目录中的（session_dir）的位置进行的存放&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;cookie:用来存储连续訪問一个頁面时所使用，是存储在客户端，对于Cookie来说是存储在用户WIN的Temp目录中的。&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;两者都可通过时间来设置时间长短&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;3.&lt;a href=&quot;http://lib.csdn.net/base/mysql&quot; class=&quot;replace_word&quot; title=&quot;MySQL知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;数据库&lt;/a&gt;中的事务是什么?&lt;br/&gt;答:事务（transaction）是作为一个单元的一组有序的数据库操作。如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。如果所有操作完成，&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;简述题:&lt;br/&gt;1、用PHP打印出前一天的时间格式是2006-5-10&amp;nbsp;22:21:21(2分)&lt;br/&gt;答:echo&amp;nbsp;date(&amp;#39;Y-m-d&amp;nbsp;H:i:s&amp;#39;,&amp;nbsp;strtotime(&amp;#39;-1&amp;nbsp;days&amp;#39;));&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;2、echo(),print(),print_r()的区别(3分)&lt;br/&gt;答:echo是PHP语句,&amp;nbsp;print和print_r是函数,语句没有返回值,函数可以有返回值(即便没有用)&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;print（）&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;只能打印出简单类型变量的值(如int,string)&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;print_r（）&amp;nbsp;可以打印出复杂类型变量的值(如数组,对象)&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;输出一个或者多个字符串&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;3、能够使HTML和PHP分离开使用的模板(1分)&lt;br/&gt;答:Smarty,Dwoo,TinyButStrong,Template&amp;nbsp;Lite,Savant,phemplate,XTemplate&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;5、使用哪些工具进行&lt;a href=&quot;http://lib.csdn.net/base/git&quot; class=&quot;replace_word&quot; title=&quot;Git知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;版本控制&lt;/a&gt;?(1分)&lt;br/&gt;答:cvs,svn,vss;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;6、如何实现字符串翻转?(3分)&lt;br/&gt;答:echo&amp;nbsp;strrev($a);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;7、优化&lt;a href=&quot;http://lib.csdn.net/base/mysql&quot; class=&quot;replace_word&quot; title=&quot;MySQL知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;MySQL&lt;/a&gt;数据库的方法。(4分，多写多得)&lt;br/&gt;答:&lt;br/&gt;1、选取最适用的字段属性,尽可能减少定义字段长度,尽量把字段设置NOT&amp;nbsp;NULL,例如&amp;#39;省份,性别&amp;#39;,最好设置为ENUM&lt;br/&gt;2、使用连接（JOIN）来代替子查询:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.删除没有任何订单客户:DELETE&amp;nbsp;FROM&amp;nbsp;customerinfo&amp;nbsp;WHERE&amp;nbsp;customerid&amp;nbsp;NOT&amp;nbsp;in(SELECT&amp;nbsp;customerid&amp;nbsp;FROM&amp;nbsp;orderinfo)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;b.提取所有没有订单客户:SELECT&amp;nbsp;FROM&amp;nbsp;customerinfo&amp;nbsp;WHERE&amp;nbsp;customerid&amp;nbsp;NOT&amp;nbsp;in(SELECT&amp;nbsp;customerid&amp;nbsp;FROM&amp;nbsp;orderinfo)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;c.提高b的速度优化:SELECT&amp;nbsp;FROM&amp;nbsp;customerinfo&amp;nbsp;LEFT&amp;nbsp;JOIN&amp;nbsp;orderid&amp;nbsp;customerinfo.customerid=orderinfo.customerid&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;WHERE&amp;nbsp;orderinfo.customerid&amp;nbsp;IS&amp;nbsp;NULL&lt;br/&gt;3、使用联合(UNION)来代替手动创建的临时表&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.创建临时表:SELECT&amp;nbsp;name&amp;nbsp;FROM&amp;nbsp;`nametest`&amp;nbsp;UNION&amp;nbsp;SELECT&amp;nbsp;username&amp;nbsp;FROM&amp;nbsp;`nametest2`&lt;br/&gt;4、事务处理:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.保证数据完整性,例如添加和修改同时,两者成立则都执行,一者失败都失败&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;BEGIN&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;INSERT&amp;nbsp;INTO&amp;nbsp;customerinfo&amp;nbsp;(name)&amp;nbsp;VALUES&amp;nbsp;(&amp;#39;$name1&amp;#39;)&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;`orderinfo`&amp;nbsp;where&amp;nbsp;customerid=&amp;quot;.$id&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;COMMIT&amp;quot;);&lt;br/&gt;5、锁定表,优化事务处理:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.我们用一个&amp;nbsp;SELECT&amp;nbsp;语句取出初始数据，通过一些计算，用&amp;nbsp;UPDATE&amp;nbsp;语句将新值更新到表中。&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;包含有&amp;nbsp;WRITE&amp;nbsp;关键字的&amp;nbsp;LOCK&amp;nbsp;TABLE&amp;nbsp;语句可以保证在&amp;nbsp;UNLOCK&amp;nbsp;TABLES&amp;nbsp;命令被执行之前，&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;不会有其它的访问来对&amp;nbsp;inventory&amp;nbsp;进行插入、更新或者删除的操作&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;LOCK&amp;nbsp;TABLE&amp;nbsp;customerinfo&amp;nbsp;READ,&amp;nbsp;orderinfo&amp;nbsp;WRITE&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;SELECT&amp;nbsp;customerid&amp;nbsp;FROM&amp;nbsp;`customerinfo`&amp;nbsp;where&amp;nbsp;id=&amp;quot;.$id);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;UPDATE&amp;nbsp;`orderinfo`&amp;nbsp;SET&amp;nbsp;ordertitle=&amp;#39;$title&amp;#39;&amp;nbsp;where&amp;nbsp;customerid=&amp;quot;.$id);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;UNLOCK&amp;nbsp;TABLES&amp;quot;);&lt;br/&gt;6、使用外键,优化锁定表&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.把customerinfo里的customerid映射到orderinfo里的customerid,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;任何一条没有合法的customerid的记录不会写到orderinfo里&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;customerinfo&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;customerid&amp;nbsp;INT&amp;nbsp;NOT&amp;nbsp;NULL,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY(customerid)&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;)TYPE&amp;nbsp;=&amp;nbsp;INNODB;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATE&amp;nbsp;TABLE&amp;nbsp;orderinfo&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;orderid&amp;nbsp;INT&amp;nbsp;NOT&amp;nbsp;NULL,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;customerid&amp;nbsp;INT&amp;nbsp;NOT&amp;nbsp;NULL,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY(customerid,orderid),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FOREIGN&amp;nbsp;KEY&amp;nbsp;(customerid)&amp;nbsp;REFERENCES&amp;nbsp;customerinfo&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(customerid)&amp;nbsp;ON&amp;nbsp;DELETE&amp;nbsp;CASCADE&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;)TYPE&amp;nbsp;=&amp;nbsp;INNODB;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;注意:&amp;#39;ON&amp;nbsp;DELETE&amp;nbsp;CASCADE&amp;#39;,该参数保证当customerinfo表中的一条记录删除的话同时也会删除order&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;表中的该用户的所有记录,注意使用外键要定义事务安全类型为INNODB;&lt;br/&gt;7、建立索引:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.格式:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;(普通索引)-&amp;gt;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;创建:CREATE&amp;nbsp;INDEX&amp;nbsp;&amp;lt;索引名&amp;gt;&amp;nbsp;ON&amp;nbsp;tablename&amp;nbsp;(索引字段)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;修改:ALTER&amp;nbsp;TABLE&amp;nbsp;tablename&amp;nbsp;ADD&amp;nbsp;INDEX&amp;nbsp;[索引名]&amp;nbsp;(索引字段)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;创表指定索引:CREATE&amp;nbsp;TABLE&amp;nbsp;tablename([...],INDEX[索引名](索引字段))&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;(唯一索引)-&amp;gt;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;创建:CREATE&amp;nbsp;UNIQUE&amp;nbsp;&amp;lt;索引名&amp;gt;&amp;nbsp;ON&amp;nbsp;tablename&amp;nbsp;(索引字段)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;修改:ALTER&amp;nbsp;TABLE&amp;nbsp;tablename&amp;nbsp;ADD&amp;nbsp;UNIQUE&amp;nbsp;[索引名]&amp;nbsp;(索引字段)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;创表指定索引:CREATE&amp;nbsp;TABLE&amp;nbsp;tablename([...],UNIQUE[索引名](索引字段))&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;(主键)-&amp;gt;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;它是唯一索引,一般在创建表是建立,格式为:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;CREATA&amp;nbsp;TABLE&amp;nbsp;tablename&amp;nbsp;([...],PRIMARY&amp;nbsp;KEY[索引字段])&lt;br/&gt;8、优化查询语句&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a.最好在相同字段进行比较操作,在建立好的索引字段上尽量减少函数操作&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;例子1:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;order&amp;nbsp;WHERE&amp;nbsp;YEAR(orderDate)&amp;lt;2008;(慢)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;order&amp;nbsp;WHERE&amp;nbsp;orderDate&amp;lt;&amp;quot;2008-01-01&amp;quot;;(快)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;例子2:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;order&amp;nbsp;WHERE&amp;nbsp;addtime/7&amp;lt;24;(慢)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;order&amp;nbsp;WHERE&amp;nbsp;addtime&amp;lt;24*7;(快)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;例子3:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;order&amp;nbsp;WHERE&amp;nbsp;title&amp;nbsp;like&amp;nbsp;&amp;quot;%good%&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;order&amp;nbsp;WHERE&amp;nbsp;title&amp;gt;=&amp;quot;good&amp;quot;&amp;nbsp;and&amp;nbsp;name&amp;lt;&amp;quot;good&amp;quot;;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;8、PHP的意思(送1分)&lt;br/&gt;答:PHP是一个基于服务端来创建动态网站的脚本语言，您可以用PHP和HTML生成网站主页&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;9、MYSQL取得当前时间的函数是?，格式化日期的函数是(2分)&lt;br/&gt;答:now(),date()&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;10、实现中文字串截取无乱码的方法。(3分)&lt;br/&gt;答:function&amp;nbsp;GBsubstr($string,&amp;nbsp;$start,&amp;nbsp;$length)&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(strlen($string)&amp;gt;$length){&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$str=null;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$len=$start+$length;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for($i=$start;$i&amp;lt;$len;$i++){&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(ord(substr($string,$i,1))&amp;gt;0xa0){&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$str.=substr($string,$i,2);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$i++;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$str.=substr($string,$i,1);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$str.&amp;#39;...&amp;#39;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$string;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;11、您是否用过版本控制软件?&amp;nbsp;如果有您用的版本控制软件的名字是?(1分)&lt;br/&gt;12、您是否用过模板引擎?&amp;nbsp;如果有您用的模板引擎的名字是?(1分)&lt;br/&gt;答:用过,smarty&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;13、请简单阐述您最得意的开发之作(4分)&lt;br/&gt;答:信息分类&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;14、对于大流量的网站,您采用什么样的方法来解决访问量问题?(4分)&lt;br/&gt;答:确认服务器硬件是否足够支持当前的流量,数据库读写分离,优化数据表,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;程序功能规则,禁止外部的盗链,控制大文件的下载,使用不同主机分流主要流量&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;15、用PHP写出显示客户端IP与服务器IP的代码1分)&lt;br/&gt;答:打印客户端IP:echo&amp;nbsp;$_SERVER[‘REMOTE_ADDR’];&amp;nbsp;或者:&amp;nbsp;getenv(&amp;#39;REMOTE_ADDR&amp;#39;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;打印服务器IP:echo&amp;nbsp;gethostbyname(&amp;quot;&lt;a target=&quot;_blank&quot; href=&quot;http://www.bolaiwu.com/&quot; style=&quot;text-decoration: none; color: rgb(12, 137, 207);&quot;&gt;www.bolaiwu.com&lt;/a&gt;&amp;quot;)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;16、语句include和require的区别是什么?为避免多次包含同一文件，可用(?)语句代替它们?&amp;nbsp;(2分)&lt;br/&gt;答:require-&amp;gt;require是无条件包含也就是如果一个流程里加入require,无论条件成立与否都会先执行require&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;include-&amp;gt;include有返回值，而require没有(可能因为如此require的速度比include快)&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;注意:包含文件不存在或者语法错误的时候require是致命的,include不是&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;17、如何修改SESSION的生存时间(1分).&lt;br/&gt;答:方法1:将php.ini中的session.gc_maxlifetime设置为9999重启apache&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;方法2:$savePath&amp;nbsp;=&amp;nbsp;&amp;quot;./session_save_dir/&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$lifeTime&amp;nbsp;=&amp;nbsp;小时&amp;nbsp;*&amp;nbsp;秒;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;session_save_path($savePath);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;session_set_cookie_params($lifeTime);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;session_start();&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;方法3:setcookie()&amp;nbsp;and&amp;nbsp;session_set_cookie_params($lifeTime);&lt;br/&gt;&amp;nbsp;&lt;br/&gt;18、有一个网页地址,&amp;nbsp;比如PHP开发资源网主页:&amp;nbsp;&lt;a target=&quot;_blank&quot; href=&quot;http://www.phpres.com/index.html&quot; style=&quot;text-decoration: none; color: rgb(12, 137, 207);&quot;&gt;http://www.phpres.com/index.html&lt;/a&gt;,如何得到它的内容?($1分)&lt;br/&gt;答:方法1(对于PHP5及更高版本):&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$readcontents&amp;nbsp;=&amp;nbsp;fopen(&amp;quot;&lt;a target=&quot;_blank&quot; href=&quot;http://www.phpres.com/index.html&quot; style=&quot;text-decoration: none; color: rgb(12, 137, 207);&quot;&gt;http://www.phpres.com/index.html&lt;/a&gt;&amp;quot;,&amp;nbsp;&amp;quot;rb&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$contents&amp;nbsp;=&amp;nbsp;stream_get_contents($readcontents);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;fclose($readcontents);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$contents;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;方法2:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;file_get_contents(&amp;quot;&lt;a target=&quot;_blank&quot; href=&quot;http://www.phpres.com/index.html&quot; style=&quot;text-decoration: none; color: rgb(12, 137, 207);&quot;&gt;http://www.phpres.com/index.html&lt;/a&gt;&amp;quot;);&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;19、在HTTP&amp;nbsp;1.0中，状态码401的含义是(?);如果返回“找不到文件”的提示，则可用&amp;nbsp;header&amp;nbsp;函数，其语句为(?);(2分)&lt;br/&gt;答:状态401代表未被授权,header(&amp;quot;Location:www.xxx.php&amp;quot;);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;12、在PHP中，heredoc是一种特殊的字符串，它的结束标志必须?(1分)&lt;br/&gt;答:heredoc的语法是用&amp;quot;&amp;lt;&amp;lt;&amp;lt;&amp;quot;加上自己定义成对的标签，在标签范围內的文字视为一个字符串&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;例子:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$str&amp;nbsp;=&amp;nbsp;&amp;lt;&amp;lt;&amp;lt;SHOW&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;my&amp;nbsp;name&amp;nbsp;is&amp;nbsp;Jiang&amp;nbsp;Qihui!&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;SHOW;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;13、谈谈asp,php,jsp的优缺点(1分)&lt;br/&gt;答:ASP全名Active&amp;nbsp;Server&amp;nbsp;Pages，是一个WEB服务器端的开发环境，&amp;nbsp;利用它可以产生和运&lt;br/&gt;行动态的、交互的、高性能的WEB服务应用程序。ASP采用脚本语言VB&amp;nbsp;Script（&lt;a href=&quot;http://lib.csdn.net/base/javase&quot; class=&quot;replace_word&quot; title=&quot;Java SE知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;Java&lt;/a&gt;&amp;nbsp;script&lt;br/&gt;）作为自己的开发语言。&amp;nbsp;&lt;br/&gt;　　PHP是一种跨平台的服务器端的&lt;a href=&quot;http://lib.csdn.net/base/embeddeddevelopment&quot; class=&quot;replace_word&quot; title=&quot;嵌入式开发知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;嵌入式&lt;/a&gt;脚本语言.&amp;nbsp;它大量地借用C,Java和Perl语言的语法&lt;br/&gt;,&amp;nbsp;并耦合PHP自己的特性,使WEB开发者能够快速地写出动态生成页面.它支持目前绝大多数数&lt;br/&gt;据库。还有一点，PHP是完全免费的，不用花钱，你可以从PHP官方站点(&lt;a target=&quot;_blank&quot; href=&quot;http://www.php.ne/&quot; style=&quot;text-decoration: none; color: rgb(12, 137, 207);&quot;&gt;http://www.php.ne&lt;/a&gt;&lt;br/&gt;t)自由下载。而且你可以不受限制地获得源码，甚至可以从中加进你自己需要的特色。&amp;nbsp;&lt;br/&gt;　　JSP&amp;nbsp;是Sun公司推出的新一代站点开发语言，他完全解决了目前ASP,PHP的一个通病－－&lt;br/&gt;脚本级执行（据说PHP4&amp;nbsp;也已经在Zend&amp;nbsp;的支持下，实现编译运行）.Sun&amp;nbsp;公司借助自己在Jav&lt;br/&gt;a&amp;nbsp;上的不凡造诣，将Java&amp;nbsp;从Java&amp;nbsp;应用程序&amp;nbsp;和&amp;nbsp;Java&amp;nbsp;Applet&amp;nbsp;之外，又有新的硕果，就是Js&lt;br/&gt;p－－Java&amp;nbsp;Server&amp;nbsp;Page。Jsp&amp;nbsp;可以在Serverlet和JavaBean的支持下，完成功能强大的站点&lt;br/&gt;程序。&amp;nbsp;&lt;br/&gt;　　三者都提供在&amp;nbsp;HTML&amp;nbsp;代码中混合某种程序代码、由语言引擎解释执行程序代码的能力。&lt;br/&gt;但JSP代码被编译成&amp;nbsp;Servlet&amp;nbsp;并由&amp;nbsp;Java&amp;nbsp;虚拟机解释执行，这种编译操作仅在对&amp;nbsp;JSP&amp;nbsp;页面的&lt;br/&gt;第一次请求时发生。在&amp;nbsp;ASP&amp;nbsp;、PHP、JSP&amp;nbsp;环境下，&amp;nbsp;HTML&amp;nbsp;代码主要负责描述信息的显示样式&lt;br/&gt;，而程序代码则用来描述处理逻辑。普通的&amp;nbsp;HTML&amp;nbsp;页面只依赖于&amp;nbsp;Web&amp;nbsp;服务器，而&amp;nbsp;ASP&amp;nbsp;、PH&lt;br/&gt;P、JSP&amp;nbsp;页面需要附加的语言引擎分析和执行程序代码。程序代码的执行结果被重新嵌入到&amp;nbsp;&lt;br/&gt;HTML&amp;nbsp;代码中，然后一起发送给浏览器。&amp;nbsp;ASP&amp;nbsp;、PHP、&amp;nbsp;JSP三者都是面向&amp;nbsp;Web&amp;nbsp;服务器的技术&lt;br/&gt;，客户端浏览器不需要任何附加的软件支持。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;14、谈谈对mvc的认识(1分)&lt;br/&gt;答:由模型(model),视图(view),控制器(controller)完成的应用程序&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;由模型发出要实现的功能到控制器,控制器接收组织功能传递给视图;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;15、写出发贴数最多的十个人名字的SQL，利用下表：members(id,username,posts,pass,email)(2分)&lt;br/&gt;答:SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;`members`&amp;nbsp;ORDER&amp;nbsp;BY&amp;nbsp;posts&amp;nbsp;DESC&amp;nbsp;limit&amp;nbsp;0,10;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;16.&amp;nbsp;请说明php中传值与传引用的区别。什么时候传值什么时候传引用?(2分)&lt;br/&gt;答:按值传递：函数范围内对值的任何改变在函数外部都会被忽略&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;按引用传递：函数范围内对值的任何改变在函数外部也能反映出这些修改&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;优缺点：按值传递时，php必须复制值。特别是对于大型的字符串和对象来说，这将会是一个代价很大的操作。&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;按引用传递则不需要复制值，对于性能提高很有好处。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;17.&amp;nbsp;在PHP中error_reporting这个函数有什么作用?&amp;nbsp;(1分)&lt;br/&gt;答:设置错误级别与错误信息回报&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;18.&amp;nbsp;请写一个函数验证电子邮件的格式是否正确&amp;nbsp;(2分)&lt;br/&gt;答:function&amp;nbsp;checkEmail($email)&lt;br/&gt;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$pregEmail&amp;nbsp;=&amp;nbsp;&amp;quot;/([a-z0-9]*[-_/.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[/.][a-z]{2,3}([/.][a-z]{2})?/i&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;preg_match($pregEmail,$email);&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;19.&amp;nbsp;简述如何得到当前执行脚本路径，包括所得到参数。(2分)&lt;br/&gt;答:$script_name&amp;nbsp;=&amp;nbsp;basename(__file__);&amp;nbsp;print_r($script_name);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;21、JS表单弹出对话框函数是?获得输入焦点函数是?&amp;nbsp;(2分)&lt;br/&gt;答:弹出对话框:&amp;nbsp;alert(),prompt(),confirm()&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;获得输入焦点&amp;nbsp;focus()&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;22、JS的转向函数是?怎么引入一个外部JS文件?(2分)&lt;br/&gt;答:window.location.href,&amp;lt;script&amp;nbsp;type=&amp;quot;text/&lt;a href=&quot;http://lib.csdn.net/base/javascript&quot; class=&quot;replace_word&quot; title=&quot;JavaScript知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;JavaScript&lt;/a&gt;&amp;quot;&amp;nbsp;src=&amp;quot;js/js_function.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;23、foo()和@foo()之间有什么区别?(1分)&lt;br/&gt;答:@foo()控制错误输出&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;24、如何声明一个名为”myclass”的没有方法和属性的类?&amp;nbsp;(1分)&lt;br/&gt;答:class&amp;nbsp;myclass{&amp;nbsp;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;25、如何实例化一个名为”myclass”的对象?(1分)&lt;br/&gt;答:new&amp;nbsp;myclass()&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;26、你如何访问和设置一个类的属性?&amp;nbsp;(2分)&lt;br/&gt;答:$object&amp;nbsp;=&amp;nbsp;new&amp;nbsp;myclass();&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$newstr&amp;nbsp;=&amp;nbsp;$object-&amp;gt;test;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$object-&amp;gt;test&amp;nbsp;=&amp;nbsp;&amp;quot;info&amp;quot;;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;27、mysql_fetch_row()&amp;nbsp;和mysql_fetch_array之间有什么区别?&amp;nbsp;(1分)&lt;br/&gt;答:mysql_fetch_row是从结果集取出1行数组,作为枚举&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_fetch_array是从结果集取出一行数组作为关联数组,或数字数组,两者兼得&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;28、GD库是做什么用的?&amp;nbsp;(1分)&lt;br/&gt;答:gd库提供了一系列用来处理图片的API，使用GD库可以处理图片，或者生成图片。&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;在网站上GD库通常用来生成缩略图或者用来对图片加水印或者对网站数据生成报表。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;29、指出一些在PHP输入一段HTML代码的办法。(1分)&lt;br/&gt;答:echo&amp;nbsp;&amp;quot;&amp;lt;a&amp;nbsp;href=&amp;#39;index.php&amp;#39;&amp;gt;aaa&amp;lt;/a&amp;gt;&amp;quot;;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;30、下面哪个函数可以打开一个文件，以对文件进行读和写操作?(1分)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(a)&amp;nbsp;fget()&amp;nbsp;(b)&amp;nbsp;file_open()&amp;nbsp;(c)&amp;nbsp;fopen()&amp;nbsp;(d)&amp;nbsp;open_file()&amp;nbsp;&amp;nbsp;[&amp;nbsp;&amp;nbsp;c&amp;nbsp;&amp;nbsp;]&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;31、下面哪个选项没有将&amp;nbsp;john&amp;nbsp;添加到users&amp;nbsp;数组中?&amp;nbsp;(1分)&lt;br/&gt;　　(a)&amp;nbsp;$users[]&amp;nbsp;=&amp;nbsp;‘john’;&lt;br/&gt;　　(b)&amp;nbsp;array_add($users,’john’);&lt;br/&gt;　　(c)&amp;nbsp;array_push($users,‘john’);&lt;br/&gt;　　(d)&amp;nbsp;$users&amp;nbsp;||=&amp;nbsp;‘john’;&amp;nbsp;&amp;nbsp;[&amp;nbsp;&amp;nbsp;a&amp;nbsp;,&amp;nbsp;c&amp;nbsp;&amp;nbsp;]&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;32、下面的程序会输入是否?(1分)&lt;br/&gt;　　$num&amp;nbsp;=&amp;nbsp;10;&lt;br/&gt;　　function&amp;nbsp;multiply(){&lt;br/&gt;　　$num&amp;nbsp;=&amp;nbsp;$num&amp;nbsp;*&amp;nbsp;10;&lt;br/&gt;　　}&lt;br/&gt;　　multiply();&lt;br/&gt;　　echo&amp;nbsp;$num;&lt;br/&gt;　　?&amp;gt;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;输出:10&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;33、使用php写一段简单查询，查出所有姓名为“张三”的内容并打印出来&amp;nbsp;(2分)&lt;br/&gt;　　表名User&lt;br/&gt;　　Name&amp;nbsp;Tel&amp;nbsp;Content&amp;nbsp;Date&lt;br/&gt;　　张三&amp;nbsp;13333663366&amp;nbsp;大专毕业&amp;nbsp;2006-10-11&lt;br/&gt;　　张三&amp;nbsp;13612312331&amp;nbsp;本科毕业&amp;nbsp;2006-10-15&lt;br/&gt;　　张四&amp;nbsp;021-55665566&amp;nbsp;中专毕业&amp;nbsp;2006-10-15&lt;br/&gt;　　请根据上面的题目完成代码：&lt;br/&gt;　　$mysql_db=mysql_connect(&amp;quot;local&amp;quot;,&amp;quot;root&amp;quot;,&amp;quot;pass&amp;quot;);&lt;br/&gt;　　@mysql_select_db(&amp;quot;DB&amp;quot;,$mysql_db);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$result&amp;nbsp;=&amp;nbsp;mysql_query(&amp;quot;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;`user`&amp;nbsp;WHERE&amp;nbsp;name=&amp;#39;张三&amp;#39;&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while($rs&amp;nbsp;=&amp;nbsp;mysql_fetch_array($result)){&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$rs[&amp;quot;tel&amp;quot;].$rs[&amp;quot;content&amp;quot;].$rs[&amp;quot;date&amp;quot;];&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;34、如何使用下面的类,并解释下面什么意思?(3)&lt;br/&gt;　　class&amp;nbsp;test{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;Get_test($num){&lt;br/&gt;　　&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$num=md5(md5($num).&amp;quot;En&amp;quot;);&lt;br/&gt;　　&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$num;&lt;br/&gt;　　&amp;nbsp;}&lt;br/&gt;　　}&lt;br/&gt;答:$testnum&amp;nbsp;=&amp;nbsp;&amp;quot;123&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$object&amp;nbsp;=&amp;nbsp;new&amp;nbsp;test();&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$encrypt&amp;nbsp;=&amp;nbsp;$object-&amp;gt;Get_test($testnum);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$encrypt;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;类test里面包含Get_test方法,实例化类调用方法多字符串加密&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;35、写出&amp;nbsp;SQL语句的格式&amp;nbsp;:&amp;nbsp;插入&amp;nbsp;，更新&amp;nbsp;，删除&amp;nbsp;(4分)&lt;br/&gt;　　表名User&lt;br/&gt;　　Name&amp;nbsp;Tel&amp;nbsp;Content&amp;nbsp;Date&lt;br/&gt;　　张三&amp;nbsp;13333663366&amp;nbsp;大专毕业&amp;nbsp;2006-10-11&lt;br/&gt;　　张三&amp;nbsp;13612312331&amp;nbsp;本科毕业&amp;nbsp;2006-10-15&lt;br/&gt;　　张四&amp;nbsp;021-55665566&amp;nbsp;中专毕业&amp;nbsp;2006-10-15&lt;br/&gt;　　(a)&amp;nbsp;有一新记录(小王&amp;nbsp;13254748547&amp;nbsp;高中毕业&amp;nbsp;2007-05-06)请用SQL语句新增至表中&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;INSERT&amp;nbsp;INTO&amp;nbsp;`user`&amp;nbsp;(name,tel,content,date)&amp;nbsp;VALUES&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&amp;#39;小王&amp;#39;,&amp;#39;13254748547&amp;#39;,&amp;#39;高中毕业&amp;#39;,&amp;#39;2007-05-06&amp;#39;)&amp;quot;)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;　　(b)&amp;nbsp;请用sql语句把张三的时间更新成为当前系统时间&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$nowDate&amp;nbsp;=&amp;nbsp;date(&amp;quot;Ymd&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;UPDATE&amp;nbsp;`user`&amp;nbsp;SET&amp;nbsp;date=&amp;#39;&amp;quot;.$nowDate.&amp;quot;&amp;#39;&amp;nbsp;WHERE&amp;nbsp;name=&amp;#39;张山&amp;#39;&amp;quot;);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;　　(c)&amp;nbsp;请写出删除名为张四的全部记录&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;mysql_query(&amp;quot;DELETE&amp;nbsp;FROM&amp;nbsp;`user`&amp;nbsp;WHERE&amp;nbsp;name=&amp;#39;张四&amp;#39;&amp;quot;);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;36、请写出数据类型(int&amp;nbsp;char&amp;nbsp;varchar&amp;nbsp;datetime&amp;nbsp;text)的意思;&amp;nbsp;请问varchar和char有什么区别(2分)&lt;br/&gt;答:int是数字类型,char固定长度字符串,varchar实际长度字符串,datetime日期时间型,text文本字符串&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;char的场地固定为创建表设置的长度,varchar为可变长度的字符&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;38、写出以下程序的输出结果&amp;nbsp;(1分)&lt;br/&gt;　　$b=201;&lt;br/&gt;　　$c=40;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$a=$b&amp;gt;$c?4:5;&lt;br/&gt;　　echo&amp;nbsp;$a;&lt;br/&gt;　　?&amp;gt;&lt;br/&gt;答:4&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;39、检测一个变量是否有设置的函数是否?是否为空的函数是?(2分)&lt;br/&gt;答:isset($str),empty($str);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;40、取得查询结果集总数的函数是?(1分)&lt;br/&gt;答:mysql_num_rows($result);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;41、$arr&amp;nbsp;=&amp;nbsp;array(&amp;#39;james&amp;#39;,&amp;nbsp;&amp;#39;tom&amp;#39;,&amp;nbsp;&amp;#39;symfony&amp;#39;);&amp;nbsp;请打印出第一个元素的值&amp;nbsp;(1分)&lt;br/&gt;答:echo&amp;nbsp;$array[0];&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;42、请将41题的数组的值用&amp;#39;,&amp;#39;号分隔并合并成字串输出(1分)&lt;br/&gt;答:for($i=0;$i&amp;lt;count($array);$i++){&amp;nbsp;echo&amp;nbsp;$array[$i].&amp;quot;,&amp;quot;;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;43、$a&amp;nbsp;=&amp;nbsp;&amp;#39;abcdef&amp;#39;;&amp;nbsp;请取出$a的值并打印出第一个字母(1分)&lt;br/&gt;答:echo&amp;nbsp;$a{0}&amp;nbsp;或&amp;nbsp;echo&amp;nbsp;substr($a,0,1)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;44、PHP可以和sql&amp;nbsp;server/&lt;a href=&quot;http://lib.csdn.net/base/oracle&quot; class=&quot;replace_word&quot; title=&quot;Oracle知识库&quot; target=&quot;_blank&quot; style=&quot;text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;&quot;&gt;Oracle&lt;/a&gt;等数据库连接吗?(1分)&lt;br/&gt;答:当然可以&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;45、请写出PHP5权限控制修饰符(3分)&lt;br/&gt;答:public(公共),private(私用),protected(继承)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;46、请写出php5的构造函数和析构函数(2分)&lt;br/&gt;答:__construct&amp;nbsp;,&amp;nbsp;__destruct&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;47、完成以下:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;(一)创建新闻发布系统，表名为message有如下字段&amp;nbsp;(3分)&lt;br/&gt;　　id&amp;nbsp;文章id&lt;br/&gt;　　title&amp;nbsp;文章标题&lt;br/&gt;　　content&amp;nbsp;文章内容&lt;br/&gt;　　category_id&amp;nbsp;文章分类id&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;hits&amp;nbsp;点击量&lt;br/&gt;答:CREATE&amp;nbsp;TABLE&amp;nbsp;&amp;#39;message&amp;#39;(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;id&amp;#39;&amp;nbsp;int(10)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;auto_increment,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;title&amp;#39;&amp;nbsp;varchar(200)&amp;nbsp;default&amp;nbsp;NULL,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;content&amp;#39;&amp;nbsp;text,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;category_id&amp;#39;&amp;nbsp;int(10)&amp;nbsp;NOT&amp;nbsp;NULL,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;hits&amp;#39;&amp;nbsp;int(20),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;PRIMARY&amp;nbsp;KEY(&amp;#39;id&amp;#39;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;)ENGINE=InnoDB&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=utf8;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(二)同样上述新闻发布系统：表comment记录用户回复内容，字段如下&amp;nbsp;(4分)&lt;br/&gt;　　comment_id&amp;nbsp;回复id&lt;br/&gt;　　id&amp;nbsp;文章id，关联message表中的id&lt;br/&gt;　　comment_content&amp;nbsp;回复内容&lt;br/&gt;　　现通过查询数据库需要得到以下格式的文章标题列表,并按照回复数量排序，回复最高的排在最前面&lt;br/&gt;　　文章id&amp;nbsp;文章标题&amp;nbsp;点击量&amp;nbsp;回复数量&lt;br/&gt;　　用一个SQL语句完成上述查询，如果文章没有回复则回复数量显示为0&lt;br/&gt;答:SELECT&amp;nbsp;message.id&amp;nbsp;id,message.title&amp;nbsp;title,IF(message.`hits`&amp;nbsp;IS&amp;nbsp;NULL,0,message.`hits`)&amp;nbsp;hits,&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;IF(comment.`id`&amp;nbsp;is&amp;nbsp;NULL,0,count(*))&amp;nbsp;number&amp;nbsp;FROM&amp;nbsp;message&amp;nbsp;LEFT&amp;nbsp;JOIN&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;comment&amp;nbsp;ON&amp;nbsp;message.id=comment.id&amp;nbsp;GROUP&amp;nbsp;BY&amp;nbsp;message.`id`;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;　　(三)上述内容管理系统，表category保存分类信息，字段如下&amp;nbsp;(3分)&lt;br/&gt;　　category_id&amp;nbsp;int(4)&amp;nbsp;not&amp;nbsp;null&amp;nbsp;auto_increment;&lt;br/&gt;　　categroy_name&amp;nbsp;varchar(40)&amp;nbsp;not&amp;nbsp;null;&lt;br/&gt;　　用户输入文章时，通过选择下拉菜单选定文章分类&lt;br/&gt;　　写出如何实现这个下拉菜单&lt;br/&gt;答:function&amp;nbsp;categoryList()&lt;br/&gt;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$result=mysql_query(&amp;quot;select&amp;nbsp;category_id,categroy_name&amp;nbsp;from&amp;nbsp;category&amp;quot;)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;or&amp;nbsp;die(&amp;quot;Invalid&amp;nbsp;query:&amp;nbsp;&amp;quot;&amp;nbsp;.&amp;nbsp;mysql_error());&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;print(&amp;quot;&amp;lt;select&amp;nbsp;name=&amp;#39;category&amp;#39;&amp;nbsp;value=&amp;#39;&amp;#39;&amp;gt;/n&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while($rowArray=mysql_fetch_array($result))&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;print(&amp;quot;&amp;lt;option&amp;nbsp;value=&amp;#39;&amp;quot;.$rowArray[&amp;#39;category_id&amp;#39;].&amp;quot;&amp;#39;&amp;gt;&amp;quot;.$rowArray[&amp;#39;categroy_name&amp;#39;].&amp;quot;&amp;lt;/option&amp;gt;/n&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;print(&amp;quot;&amp;lt;/select&amp;gt;&amp;quot;);&lt;br/&gt;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;编程题:&lt;br/&gt;1.&amp;nbsp;写一个函数，尽可能高效的，从一个标准&amp;nbsp;url&amp;nbsp;里取出文件的扩展名&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;例如:&amp;nbsp;&lt;a target=&quot;_blank&quot; href=&quot;http://www.sina.com.cn/abc/de/fg.php?id=1&quot; style=&quot;text-decoration: none; color: rgb(12, 137, 207);&quot;&gt;http://www.sina.com.cn/abc/de/fg.php?id=1&lt;/a&gt;&amp;nbsp;需要取出&amp;nbsp;php&amp;nbsp;或&amp;nbsp;.php&lt;br/&gt;答案1:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;getExt($url){&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$arr&amp;nbsp;=&amp;nbsp;parse_url($url);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$file&amp;nbsp;=&amp;nbsp;basename($arr[&amp;#39;path&amp;#39;]);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;$ext&amp;nbsp;=&amp;nbsp;explode(&amp;quot;.&amp;quot;,$file);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$ext[1];&lt;br/&gt;}&lt;br/&gt;答案2:&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;getExt($url)&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$url&amp;nbsp;=&amp;nbsp;basename($url);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$pos1&amp;nbsp;=&amp;nbsp;strpos($url,&amp;quot;.&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$pos2&amp;nbsp;=&amp;nbsp;strpos($url,&amp;quot;?&amp;quot;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(strstr($url,&amp;quot;?&amp;quot;)){&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;substr($url,$pos1&amp;nbsp;+&amp;nbsp;1,$pos2&amp;nbsp;-&amp;nbsp;$pos1&amp;nbsp;-&amp;nbsp;1);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;else&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;substr($url,$pos1);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;br/&gt;2.&amp;nbsp;在&amp;nbsp;HTML&amp;nbsp;语言中，页面头部的&amp;nbsp;meta&amp;nbsp;标记可以用来输出文件的编码格式，以下是一个标准的&amp;nbsp;meta&amp;nbsp;语句&lt;br/&gt;　　请使用&amp;nbsp;PHP&amp;nbsp;语言写一个函数，把一个标准&amp;nbsp;HTML&amp;nbsp;页面中的类似&amp;nbsp;meta&amp;nbsp;标记中的&amp;nbsp;charset&amp;nbsp;部分值改为&amp;nbsp;big5&lt;br/&gt;　　请注意:&lt;br/&gt;　　1.&amp;nbsp;需要处理完整的&amp;nbsp;html&amp;nbsp;页面，即不光此&amp;nbsp;meta&amp;nbsp;语句&lt;br/&gt;　　2.&amp;nbsp;忽略大小写&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;3.&amp;nbsp;&amp;#39;&amp;nbsp;和&amp;nbsp;&amp;quot;&amp;nbsp;在此处是可以互换的&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;4.&amp;nbsp;&amp;#39;Content-Type&amp;#39;&amp;nbsp;两侧的引号是可以忽略的，但&amp;nbsp;&amp;#39;text/html;&amp;nbsp;charset=gbk&amp;#39;&amp;nbsp;两侧的不行&lt;br/&gt;　　5.&amp;nbsp;注意处理多余空格&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;3.&amp;nbsp;写一个函数，算出两个文件的相对路径&lt;br/&gt;　　如&amp;nbsp;$a&amp;nbsp;=&amp;nbsp;&amp;#39;/a/b/c/d/e.php&amp;#39;;&lt;br/&gt;　　$b&amp;nbsp;=&amp;nbsp;&amp;#39;/a/b/12/34/c.php&amp;#39;;&lt;br/&gt;　　计算出&amp;nbsp;$b&amp;nbsp;相对于&amp;nbsp;$a&amp;nbsp;的相对路径应该是&amp;nbsp;../../c/d将()添上&lt;br/&gt;答:function&amp;nbsp;getRelativePath($a,&amp;nbsp;$b)&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$returnPath&amp;nbsp;=&amp;nbsp;array(dirname($b));&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$arrA&amp;nbsp;=&amp;nbsp;explode(&amp;#39;/&amp;#39;,&amp;nbsp;$a);&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$arrB&amp;nbsp;=&amp;nbsp;explode(&amp;#39;/&amp;#39;,&amp;nbsp;$returnPath[0]);&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for&amp;nbsp;($n&amp;nbsp;=&amp;nbsp;1,&amp;nbsp;$len&amp;nbsp;=&amp;nbsp;count($arrB);&amp;nbsp;$n&amp;nbsp;&amp;lt;&amp;nbsp;$len;&amp;nbsp;$n++)&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;($arrA[$n]&amp;nbsp;!=&amp;nbsp;$arrB[$n])&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;break;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;($len&amp;nbsp;-&amp;nbsp;$n&amp;nbsp;&amp;gt;&amp;nbsp;0)&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$returnPath&amp;nbsp;=&amp;nbsp;array_merge($returnPath,&amp;nbsp;array_fill(1,&amp;nbsp;$len&amp;nbsp;-&amp;nbsp;$n,&amp;nbsp;&amp;#39;..&amp;#39;));&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$returnPath&amp;nbsp;=&amp;nbsp;array_merge($returnPath,&amp;nbsp;array_slice($arrA,&amp;nbsp;$n));&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;implode(&amp;#39;/&amp;#39;,&amp;nbsp;$returnPath);&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;getRelativePath($a,&amp;nbsp;$b);&amp;nbsp;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;填空题:&lt;br/&gt;1.在PHP中，当前脚本的名称(不包括路径和查询字符串)记录在预定义变量__$_SERVER[&amp;#39;PHP_SELF&amp;#39;]__中;而链接到当前页面的URL记录在预定义变量__$_SERVER[&amp;#39;HTTP_REFERER&amp;#39;]__&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;中&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;2.执行程序段&amp;lt;?php&amp;nbsp;echo&amp;nbsp;8%(-2)&amp;nbsp;?&amp;gt;将输出__0__。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;3.在HTTP&amp;nbsp;1.0中，状态码&amp;nbsp;401&amp;nbsp;的含义是____;如果返回“找不到文件”的提示，则可用&amp;nbsp;header&amp;nbsp;函数，其语句为____。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;4.数组函数&amp;nbsp;arsort&amp;nbsp;的作用是__对数组进行逆向排序并保持索引关系__;语句&amp;nbsp;error_reporting(2047)的作用是__报告所有错误和警告__。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;5.PEAR中的数据库连接字符串格式是____。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;6.写出一个正则表达式，过虑网页上的所有JS/VBS脚本(即把scrīpt标记及其内容都去掉):preg_replace(&amp;quot;&amp;nbsp;/&amp;lt;script[^&amp;gt;].*?&amp;gt;.*?&amp;lt;/script&amp;gt;/si&amp;quot;,&amp;nbsp;&amp;quot;newinfo&amp;quot;,&amp;nbsp;$script);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;7.以Apache模块的方式安装PHP，在文件http.conf中首先要用语句____动态装载PHP模块，然后再用语句____使得Apache把所有扩展名为php的文件都作为PHP脚本处理。&lt;br/&gt;&amp;nbsp;&amp;nbsp;LoadModule&amp;nbsp;php5_module&amp;nbsp;&amp;quot;c:/php/php5apache2.dll&amp;quot;&amp;nbsp;,&amp;nbsp;AddType&amp;nbsp;application/x-httpd-php&amp;nbsp;.php,&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;8.语句&amp;nbsp;include&amp;nbsp;和&amp;nbsp;require&amp;nbsp;都能把另外一个文件包含到当前文件中，它们的区别是____;为了避免多次包含同一文件，可以用语句__require_once||include_once__来代替它们。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;9.类的属性可以序列化后保存到&amp;nbsp;session&amp;nbsp;中，从而以后可以恢复整个类，这要用到的函数是____。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;10.一个函数的参数不能是对变量的引用，除非在php.ini中把__allow_call_time_pass_reference&amp;nbsp;boolean__设为on.&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;11.SQL中LEFT&amp;nbsp;JOIN的含义是__自然左外链接__。如果&amp;nbsp;tbl_user记录了学生的姓名(name)和学号(ID)，tbl_score记录了学生(有的学生考试以后被开除了，没有其记录)的学号(ID)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;和考试成绩(score)以及考试科目(subject)，要想打印出各个学生姓名及对应的的各科总成绩，则可以用SQL语句____。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;12.在PHP中，heredoc是一种特殊的字符串，它的结束标志必须____。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;编程题:&lt;br/&gt;13.写一个函数，能够遍历一个文件夹下的所有文件和子文件夹。&lt;br/&gt;答:&lt;br/&gt;function&amp;nbsp;my_scandir($dir)&lt;br/&gt;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$files&amp;nbsp;=&amp;nbsp;array();&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(&amp;nbsp;$handle&amp;nbsp;=&amp;nbsp;opendir($dir)&amp;nbsp;)&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while&amp;nbsp;(&amp;nbsp;($file&amp;nbsp;=&amp;nbsp;readdir($handle))&amp;nbsp;!==&amp;nbsp;false&amp;nbsp;)&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(&amp;nbsp;$file&amp;nbsp;!=&amp;nbsp;&amp;quot;..&amp;quot;&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;$file&amp;nbsp;!=&amp;nbsp;&amp;quot;.&amp;quot;&amp;nbsp;)&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(&amp;nbsp;is_dir($dir&amp;nbsp;.&amp;nbsp;&amp;quot;/&amp;quot;&amp;nbsp;.&amp;nbsp;$file)&amp;nbsp;)&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$files[$file]&amp;nbsp;=&amp;nbsp;scandir($dir&amp;nbsp;.&amp;nbsp;&amp;quot;/&amp;quot;&amp;nbsp;.&amp;nbsp;$file);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$files[]&amp;nbsp;=&amp;nbsp;$file;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;closedir($handle);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$files;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;14.简述论坛中无限分类的实现原理。&lt;br/&gt;答:&lt;br/&gt;&amp;lt;?php&lt;br/&gt;/*&lt;br/&gt;数据表结构如下:&lt;br/&gt;CREATE&amp;nbsp;TABLE&amp;nbsp;`category`&amp;nbsp;(&lt;br/&gt;&amp;nbsp;`categoryID`&amp;nbsp;smallint(5)&amp;nbsp;unsigned&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;auto_increment,&lt;br/&gt;&amp;nbsp;`categoryParentID`&amp;nbsp;smallint(5)&amp;nbsp;unsigned&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;default&amp;nbsp;&amp;#39;0&amp;#39;,&lt;br/&gt;&amp;nbsp;`categoryName`&amp;nbsp;varchar(50)&amp;nbsp;NOT&amp;nbsp;NULL&amp;nbsp;default&amp;nbsp;&amp;#39;&amp;#39;,&lt;br/&gt;&amp;nbsp;PRIMARY&amp;nbsp;KEY&amp;nbsp;(`categoryID`)&lt;br/&gt;)&amp;nbsp;ENGINE=MyISAM&amp;nbsp;DEFAULT&amp;nbsp;CHARSET=gbk;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;INSERT&amp;nbsp;INTO&amp;nbsp;`category`&amp;nbsp;(&amp;nbsp;`categoryParentID`,&amp;nbsp;`categoryName`)&amp;nbsp;VALUES&amp;nbsp;&lt;br/&gt;(0,&amp;nbsp;&amp;#39;一级类别&amp;#39;),&lt;br/&gt;(1,&amp;nbsp;&amp;#39;二级类别&amp;#39;),&lt;br/&gt;(1,&amp;nbsp;&amp;#39;二级类别&amp;#39;),&lt;br/&gt;(1,&amp;nbsp;&amp;#39;二级类别&amp;#39;),&lt;br/&gt;(2,&amp;nbsp;&amp;#39;三级类别&amp;#39;),&lt;br/&gt;(2,&amp;nbsp;&amp;#39;333332&amp;#39;),&lt;br/&gt;(2,&amp;nbsp;&amp;#39;234234&amp;#39;),&lt;br/&gt;(3,&amp;nbsp;&amp;#39;aqqqqqd&amp;#39;),&lt;br/&gt;(4,&amp;nbsp;&amp;#39;哈哈&amp;#39;),&lt;br/&gt;(5,&amp;nbsp;&amp;#39;66333666&amp;#39;);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;*/&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;//指定分类id变量$category_id,然后返回该分类的所有子类&lt;br/&gt;//$default_category为默认的选中的分类&lt;br/&gt;function&amp;nbsp;Get_Category($category_id&amp;nbsp;=&amp;nbsp;0,$level&amp;nbsp;=&amp;nbsp;0,&amp;nbsp;$default_category&amp;nbsp;=&amp;nbsp;0)&lt;br/&gt;{&lt;br/&gt;&amp;nbsp;global&amp;nbsp;$DB;&lt;br/&gt;&amp;nbsp;$sql&amp;nbsp;=&amp;nbsp;&amp;quot;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;category&amp;nbsp;ORDER&amp;nbsp;BY&amp;nbsp;categoryID&amp;nbsp;DESC&amp;quot;;&lt;br/&gt;&amp;nbsp;$result&amp;nbsp;=&amp;nbsp;$DB-&amp;gt;query(&amp;nbsp;$sql&amp;nbsp;);&lt;br/&gt;&amp;nbsp;while&amp;nbsp;($rows&amp;nbsp;=&amp;nbsp;$DB-&amp;gt;fetch_array($result))&amp;nbsp;&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;$category_array[$rows[categoryParentID]][$rows[categoryID]]&amp;nbsp;=&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;$rows[categoryID],&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;$rows[categoryParentID],&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;$rows&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;[categoryName]);&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;if&amp;nbsp;(!isset($category_array[$category_id]))&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;return&amp;nbsp;&amp;quot;&amp;quot;;&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;foreach($category_array[$category_id]&amp;nbsp;AS&amp;nbsp;$key&amp;nbsp;=&amp;gt;&amp;nbsp;$category)&lt;br/&gt;&amp;nbsp;{&amp;nbsp;&lt;br/&gt;&amp;nbsp;if&amp;nbsp;($category[&amp;#39;id&amp;#39;]&amp;nbsp;==&amp;nbsp;$default_category)&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;echo&amp;nbsp;&amp;quot;&amp;lt;option&amp;nbsp;selected&amp;nbsp;value=&amp;quot;.$category[&amp;#39;id&amp;#39;].&amp;quot;&amp;quot;;&lt;br/&gt;&amp;nbsp;}else&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;echo&amp;nbsp;&amp;quot;&amp;lt;option&amp;nbsp;value=&amp;quot;.$category[&amp;#39;id&amp;#39;].&amp;quot;&amp;quot;;&lt;br/&gt;&amp;nbsp;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;if&amp;nbsp;($level&amp;nbsp;&amp;gt;&amp;nbsp;0)&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;echo&amp;nbsp;&amp;quot;&amp;gt;&amp;quot;&amp;nbsp;.&amp;nbsp;str_repeat(&amp;nbsp;&amp;quot;&amp;nbsp;&amp;quot;,&amp;nbsp;$level&amp;nbsp;)&amp;nbsp;.&amp;nbsp;&amp;quot;&amp;nbsp;&amp;quot;&amp;nbsp;.&amp;nbsp;$category[&amp;#39;name&amp;#39;]&amp;nbsp;.&amp;nbsp;&amp;quot;&amp;lt;/option&amp;gt;/n&amp;quot;;&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;else&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;echo&amp;nbsp;&amp;quot;&amp;gt;&amp;quot;&amp;nbsp;.&amp;nbsp;$category[&amp;#39;name&amp;#39;]&amp;nbsp;.&amp;nbsp;&amp;quot;&amp;lt;/option&amp;gt;/n&amp;quot;;&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;Get_Category($key,&amp;nbsp;$level&amp;nbsp;+&amp;nbsp;1,&amp;nbsp;$default_category);&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;unset($category_array[$category_id]);&lt;br/&gt;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;/*&lt;br/&gt;函数返回的数组格式如下所示:&lt;br/&gt;Array&amp;nbsp;&lt;br/&gt;(&lt;br/&gt;&amp;nbsp;[1]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;一级类别&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;0&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;0&amp;nbsp;)&lt;br/&gt;&amp;nbsp;[4]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;4&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;二级类别&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;)&lt;br/&gt;&amp;nbsp;[9]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;9&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;哈哈&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;4&amp;nbsp;)&lt;br/&gt;&amp;nbsp;[3]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;3&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;二级类别&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;)&amp;nbsp;&lt;br/&gt;&amp;nbsp;[8]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;8&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;aqqqqqd&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;3&amp;nbsp;)&lt;br/&gt;&amp;nbsp;[2]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;二级类别&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;1&amp;nbsp;)&lt;br/&gt;&amp;nbsp;[7]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;7&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;234234&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;)&lt;br/&gt;&amp;nbsp;[6]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;6&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;333332&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;)&amp;nbsp;&lt;br/&gt;&amp;nbsp;[5]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;5&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;三级类别&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;2&amp;nbsp;)&amp;nbsp;&lt;br/&gt;&amp;nbsp;[10]&amp;nbsp;=&amp;gt;&amp;nbsp;Array&amp;nbsp;(&amp;nbsp;[id]&amp;nbsp;=&amp;gt;&amp;nbsp;10&amp;nbsp;[name]&amp;nbsp;=&amp;gt;&amp;nbsp;66333666&amp;nbsp;[level]&amp;nbsp;=&amp;gt;&amp;nbsp;3&amp;nbsp;[ParentID]&amp;nbsp;=&amp;gt;&amp;nbsp;5&amp;nbsp;)&amp;nbsp;&lt;br/&gt;)&lt;br/&gt;*/&lt;br/&gt;//指定分类id,然后返回数组&lt;br/&gt;function&amp;nbsp;Category_array($category_id&amp;nbsp;=&amp;nbsp;0,$level=0)&lt;br/&gt;{&lt;br/&gt;&amp;nbsp;global&amp;nbsp;$DB;&lt;br/&gt;&amp;nbsp;$sql&amp;nbsp;=&amp;nbsp;&amp;quot;SELECT&amp;nbsp;*&amp;nbsp;FROM&amp;nbsp;category&amp;nbsp;ORDER&amp;nbsp;BY&amp;nbsp;categoryID&amp;nbsp;DESC&amp;quot;;&lt;br/&gt;&amp;nbsp;$result&amp;nbsp;=&amp;nbsp;$DB-&amp;gt;query($sql);&lt;br/&gt;&amp;nbsp;while&amp;nbsp;($rows&amp;nbsp;=&amp;nbsp;$DB-&amp;gt;fetch_array($result))&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;$category_array[$rows[&amp;#39;categoryParentID&amp;#39;]][$rows[&amp;#39;categoryID&amp;#39;]]&amp;nbsp;=&amp;nbsp;$rows;&lt;br/&gt;&amp;nbsp;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;foreach&amp;nbsp;($category_array&amp;nbsp;AS&amp;nbsp;$key=&amp;gt;$val)&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;if&amp;nbsp;($key&amp;nbsp;==&amp;nbsp;$category_id)&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;foreach&amp;nbsp;($val&amp;nbsp;AS&amp;nbsp;$k=&amp;gt;&amp;nbsp;$v)&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;$options[$k]&amp;nbsp;=&lt;br/&gt;&amp;nbsp;array(&lt;br/&gt;&amp;nbsp;&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;$v[&amp;#39;categoryID&amp;#39;],&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;$v[&amp;#39;categoryName&amp;#39;],&amp;nbsp;&amp;#39;level&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;$level,&amp;nbsp;&amp;#39;ParentID&amp;#39;=&amp;gt;$v[&amp;#39;categoryParentID&amp;#39;]&lt;br/&gt;&amp;nbsp;);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;$children&amp;nbsp;=&amp;nbsp;Category_array($k,&amp;nbsp;$level+1);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;if&amp;nbsp;(count($children)&amp;nbsp;&amp;gt;&amp;nbsp;0)&lt;br/&gt;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;$options&amp;nbsp;=&amp;nbsp;$options&amp;nbsp;+&amp;nbsp;$children;&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;unset($category_array[$category_id]);&lt;br/&gt;&amp;nbsp;return&amp;nbsp;$options;&lt;br/&gt;}&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;?&amp;gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;lt;?php&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;class&amp;nbsp;cate&lt;br/&gt;{&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;Get_Category($category_id&amp;nbsp;=&amp;nbsp;0,$level&amp;nbsp;=&amp;nbsp;0,&amp;nbsp;$default_category&amp;nbsp;=&amp;nbsp;0)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$category_id;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$arr&amp;nbsp;=&amp;nbsp;array(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;0&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;1&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;1,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;0,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;1111&amp;#39;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;2&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;2,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;0,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;2222&amp;#39;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;4&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;4,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;0,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;4444&amp;#39;)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;1&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;3&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;3,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;1,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;333333&amp;#39;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;5&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;5,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;1,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;555555&amp;#39;)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;3&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;6&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;6,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;3,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;66666&amp;#39;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;7&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;7,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;3,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;77777&amp;#39;)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;4&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;8&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;8,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;4,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;8888&amp;#39;),&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#39;9&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;array(&amp;#39;id&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;9,&amp;nbsp;&amp;#39;parent&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;4,&amp;nbsp;&amp;#39;name&amp;#39;&amp;nbsp;=&amp;gt;&amp;nbsp;&amp;#39;9999&amp;#39;)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(!isset($arr[$category_id]))&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;&amp;quot;&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;foreach($arr[$category_id]&amp;nbsp;AS&amp;nbsp;$key&amp;nbsp;=&amp;gt;&amp;nbsp;$cate)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;($cate[&amp;#39;id&amp;#39;]&amp;nbsp;==&amp;nbsp;$default_category)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$txt&amp;nbsp;=&amp;nbsp;&amp;quot;&amp;lt;option&amp;nbsp;selected&amp;nbsp;value=&amp;quot;.$cate[&amp;#39;id&amp;#39;].&amp;quot;&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$txt&amp;nbsp;=&amp;nbsp;&amp;quot;&amp;lt;option&amp;nbsp;value=&amp;quot;.$cate[&amp;#39;id&amp;#39;].&amp;quot;&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;($level&amp;nbsp;&amp;gt;&amp;nbsp;0)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$txt1&amp;nbsp;=&amp;nbsp;&amp;quot;&amp;gt;&amp;quot;&amp;nbsp;.&amp;nbsp;str_repeat(&amp;nbsp;&amp;quot;-&amp;quot;,&amp;nbsp;$level&amp;nbsp;)&amp;nbsp;.&amp;nbsp;&amp;quot;&amp;nbsp;&amp;quot;&amp;nbsp;.&amp;nbsp;$cate[&amp;#39;name&amp;#39;]&amp;nbsp;.&amp;nbsp;&amp;quot;&amp;lt;/option&amp;gt;/n&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$txt1&amp;nbsp;=&amp;nbsp;&amp;quot;&amp;gt;&amp;quot;&amp;nbsp;.&amp;nbsp;$cate[&amp;#39;name&amp;#39;]&amp;nbsp;.&amp;nbsp;&amp;quot;&amp;lt;/option&amp;gt;/n&amp;quot;;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$val&amp;nbsp;=&amp;nbsp;$txt.$txt1;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;$val;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;self::Get_Category($key,&amp;nbsp;$level&amp;nbsp;+&amp;nbsp;1,&amp;nbsp;$default_category);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;function&amp;nbsp;getFlush($category_id&amp;nbsp;=&amp;nbsp;0,$level&amp;nbsp;=&amp;nbsp;0,&amp;nbsp;$default_category&amp;nbsp;=&amp;nbsp;0)&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ob_start();&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;self::Get_Category($category_id&amp;nbsp;,$level,&amp;nbsp;$default_category);&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$out&amp;nbsp;=&amp;nbsp;ob_get_contents();&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 15px; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ob_end_clean();&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;$out;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;}&lt;br/&gt;$id&amp;nbsp;=$_GET[&amp;#39;id&amp;#39;];&lt;br/&gt;echo&amp;nbsp;&amp;quot;&amp;lt;select&amp;gt;&amp;quot;;&lt;br/&gt;$c&amp;nbsp;=&amp;nbsp;new&amp;nbsp;cate();&lt;br/&gt;//$c-&amp;gt;Get_Category();&lt;br/&gt;$ttt=&amp;nbsp;&amp;nbsp;$c-&amp;gt;getFlush($id,&amp;#39;0&amp;#39;,&amp;#39;3&amp;#39;);&lt;br/&gt;echo&amp;nbsp;$ttt;&lt;br/&gt;echo&amp;nbsp;&amp;quot;&amp;lt;/select&amp;gt;&amp;quot;;&lt;br/&gt;?&amp;gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489586899') [ RunTime:0.3018s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000046s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000123s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.160562s ]
INFO: [ view_parse ] --END-- [ RunTime:0.160627s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000166s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000189s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0731s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0258s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000061s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.211576s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.094097s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.099703s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000009s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.193662s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.040805s ]
INFO: [ app_end ] --END-- [ RunTime:0.040933s ]

[ 2017-03-15T22:08:23+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000018s ]
INFO: [ app_init ] --END-- [ RunTime:0.047584s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.045585s ]
INFO: [ app_begin ] --END-- [ RunTime:0.045644s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0266s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0264s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.020181s ]
INFO: [ template_filter ] --END-- [ RunTime:0.020315s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.292752s ]
INFO: [ view_parse ] --END-- [ RunTime:0.292812s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000152s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000175s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.069150s ]
INFO: [ app_end ] --END-- [ RunTime:0.069233s ]

[ 2017-03-15T22:11:30+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000015s ]
INFO: [ app_init ] --END-- [ RunTime:0.000426s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.046629s ]
INFO: [ app_begin ] --END-- [ RunTime:0.046703s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0250s ]
NOTIC: [8] Undefined index: validate /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /web/www/blog/tp3/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `bk_article` (`title`,`cate_id`,`introduction`,`content`,`addtime`) VALUES ('MySQL中的if和case语句使用总结','2','MySQL中的if和case语句使用总结','&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;strong&gt;IF表达式&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;93963&quot; class=&quot;copybut&quot; id=&quot;copybut93963&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;IF(expr1,expr2,expr3)&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;如果 expr1 是TRUE (expr1 &amp;lt;&amp;gt; 0 and expr1 &amp;lt;&amp;gt; NULL)，则 IF()的返回值为expr2; 否则返回值则为 expr3。IF() 的返回值为数字值或字符串值，具体情况视其所在语境而定。&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;85677&quot; class=&quot;copybut&quot; id=&quot;copybut85677&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;select *,if(sva=1,&amp;quot;男&amp;quot;,&amp;quot;女&amp;quot;) as ssva from taname where sva != &amp;quot;&amp;quot;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;strong&gt;作为表达式的if也可以用CASE when来实现：&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;63651&quot; class=&quot;copybut&quot; id=&quot;copybut63651&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;select CASE sva WHEN 1 THEN &amp;#39;男&amp;#39; ELSE &amp;#39;女&amp;#39; END as ssva from taname where sva != &amp;#39;&amp;#39;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;在第一个方案的返回结果中， value=compare-value。而第二个方案的返回结果是第一种情况的真实结果。如果没有匹配的结果值，则返回结果为ELSE后的结果，如果没有ELSE 部分，则返回值为 NULL。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;例如：&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;3171&quot; class=&quot;copybut&quot; id=&quot;copybut3171&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;SELECT CASE 1 WHEN 1 THEN &amp;#39;one&amp;#39;&lt;br/&gt;&amp;nbsp; WHEN 2 THEN &amp;#39;two&amp;#39;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp; ELSE &amp;#39;more&amp;#39; END&lt;br/&gt;as testCol&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;将输出one&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;strong&gt;IFNULL(expr1,expr2)&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;假如expr1 不为 NULL，则 IFNULL() 的返回值为 expr1; 否则其返回值为 expr2。IFNULL()的返回值是数字或是字符串，具体情况取决于其所使用的语境。&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;84609&quot; class=&quot;copybut&quot; id=&quot;copybut84609&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;mysql&amp;gt; SELECT IFNULL(1,0);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; -&amp;gt; 1&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;mysql&amp;gt; SELECT IFNULL(NULL,10);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; -&amp;gt; 10&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;mysql&amp;gt; SELECT IFNULL(1/0,10);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; -&amp;gt; 10&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;mysql&amp;gt; SELECT IFNULL(1/0,&amp;#39;yes&amp;#39;);&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; -&amp;gt; &amp;#39;yes&amp;#39;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;IFNULL(expr1,expr2) 的默认结果值为两个表达式中更加“通用”的一个，顺序为STRING、 REAL或 INTEGER。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;strong&gt;IF ELSE 做为流程控制语句使用&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;if实现条件判断，满足不同条件执行不同的操作，这个我们只要学编程的都知道if的作用了，下面我们来看看mysql 存储过程中的if是如何使用的吧。&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;66855&quot; class=&quot;copybut&quot; id=&quot;copybut66855&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;IF search_condition THEN&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; statement_list&amp;nbsp;&amp;nbsp;&lt;br/&gt;[ELSEIF search_condition THEN]&amp;nbsp;&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; statement_list ...&amp;nbsp;&amp;nbsp;&lt;br/&gt;[ELSE&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; statement_list]&amp;nbsp;&amp;nbsp;&lt;br/&gt;END IF&amp;nbsp;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;与PHP中的IF语句类似，当IF中条件search_condition成立时，执行THEN后的statement_list语句，否则判断ELSEIF中的条件，成立则执行其后的statement_list语句，否则继续判断其他分支。当所有分支的条件均不成立时，执行ELSE分支。search_condition是一个条件表达式，可以由“=、&amp;lt;、&amp;lt;=、&amp;gt;、&amp;gt;=、!=”等条件运算符组成，并且可以使用AND、OR、NOT对多个表达式进行组合。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;例如，建立一个存储过程，该存储过程通过学生学号（student_no）和课程编号（course_no）查询其成绩（grade），返回成绩和成绩的等级，成绩大于90分的为A级，小于90分大于等于80分的为B级，小于80分大于等于70分的为C级，依次到E级。那么，创建存储过程的代码如下：&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 21.6px; font-size: 12px; float: right;&quot;&gt;&lt;a data=&quot;93558&quot; class=&quot;copybut&quot; id=&quot;copybut93558&quot; style=&quot;color: rgb(51, 51, 51); cursor: pointer;&quot;&gt;&lt;span style=&quot;text-decoration:underline;&quot;&gt;复制代码&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;代码如下:&lt;/p&gt;&lt;p&gt;&lt;br/&gt;create procedure dbname.proc_getGrade&amp;nbsp;&amp;nbsp;&lt;br/&gt;(stu_no varchar(20),cour_no varchar(10))&amp;nbsp;&amp;nbsp;&lt;br/&gt;BEGIN&amp;nbsp;&lt;br/&gt;declare stu_grade float;&amp;nbsp;&amp;nbsp;&lt;br/&gt;select grade into stu_grade from grade where student_no=stu_no and course_no=cour_no;&amp;nbsp;&amp;nbsp;&lt;br/&gt;if stu_grade&amp;gt;=90 then&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; select stu_grade,&amp;#39;A&amp;#39;;&amp;nbsp;&amp;nbsp;&lt;br/&gt;elseif stu_grade&amp;lt;90 and stu_grade&amp;gt;=80 then&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; select stu_grade,&amp;#39;B&amp;#39;;&amp;nbsp;&amp;nbsp;&lt;br/&gt;elseif stu_grade&amp;lt;80 and stu_grade&amp;gt;=70 then&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; select stu_grade,&amp;#39;C&amp;#39;;&amp;nbsp;&amp;nbsp;&lt;br/&gt;elseif stu_grade70 and stu_grade&amp;gt;=60 then&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; select stu_grade,&amp;#39;D&amp;#39;;&amp;nbsp;&amp;nbsp;&lt;br/&gt;else&amp;nbsp;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; select stu_grade,&amp;#39;E&amp;#39;;&amp;nbsp;&amp;nbsp;&lt;br/&gt;end if;&amp;nbsp;&amp;nbsp;&lt;br/&gt;END&amp;nbsp;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;注意：IF作为一条语句，在END IF后需要加上分号“;”以表示语句结束，其他语句如CASE、LOOP等也是相同的。&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; padding: 5px 0px;&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;h4 style=&quot;margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 102, 153);&quot;&gt;您可能感兴趣的文章:&lt;/h4&gt;&lt;ul style=&quot;list-style-type: none;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/25659.htm&quot; title=&quot;MySQL中使用case when 语句实现多条件查询的方法&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;MySQL中使用case when 语句实现多条件查询的方法&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/28222.htm&quot; title=&quot;SQL集合函数中case when then 使用技巧&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;SQL集合函数中case when then 使用技巧&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/28680.htm&quot; title=&quot;MySQL 的CASE WHEN 语句使用说明&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;MySQL 的CASE WHEN 语句使用说明&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/32187.htm&quot; title=&quot;mysql中IFNULL,IF,CASE的区别介绍&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;mysql中IFNULL,IF,CASE的区别介绍&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/41240.htm&quot; title=&quot;sum(case when then)(判断男女生的个数)&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;sum(case when then)(判断男女生的个数)&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/46205.htm&quot; title=&quot;MYSQL中有关SUM字段按条件统计使用IF函数(case)问题&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;MYSQL中有关SUM字段按条件统计使用IF函数(case)问题&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/50059.htm&quot; title=&quot;MySQL的CASE WHEN语句的几个使用实例&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;MySQL的CASE WHEN语句的几个使用实例&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/51544.htm&quot; title=&quot;sql学习之CASE WHEN THEN ELSE END的用法&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;sql学习之CASE WHEN THEN ELSE END的用法&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.jb51.net/article/76997.htm&quot; title=&quot;详解Mysql case then使用&quot; target=&quot;_blank&quot; style=&quot;color: rgb(255, 102, 0); text-decoration: none;&quot;&gt;详解Mysql case then使用&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;','1489587089') [ RunTime:0.0510s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000049s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000143s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.186972s ]
INFO: [ view_parse ] --END-- [ RunTime:0.187048s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000194s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000229s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0413s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0258s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000066s ]
INFO: [ template_filter ] --END-- [ RunTime:-0.205553s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.135650s ]
INFO: [ view_parse ] --END-- [ RunTime:-0.067898s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000012s ]
INFO: [ view_filter ] --END-- [ RunTime:-0.203409s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000676s ]
INFO: [ app_end ] --END-- [ RunTime:0.000755s ]

[ 2017-03-15T22:11:32+08:00 ] 183.232.228.22 /Admin.php/Blog/add.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000014s ]
INFO: [ app_init ] --END-- [ RunTime:0.000303s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000501s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000564s ]
SQL: SHOW COLUMNS FROM `bk_category` [ RunTime:0.0251s ]
SQL: SELECT * FROM `bk_category`  [ RunTime:0.0249s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000085s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000159s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.204600s ]
INFO: [ view_parse ] --END-- [ RunTime:0.204657s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000144s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000171s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000570s ]
INFO: [ app_end ] --END-- [ RunTime:0.000648s ]

[ 2017-03-15T22:11:50+08:00 ] 183.232.228.22 /Admin.php/Blog/article.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000019s ]
INFO: [ app_init ] --END-- [ RunTime:0.000404s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.043790s ]
INFO: [ app_begin ] --END-- [ RunTime:0.043875s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0261s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0261s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0261s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 0,10   [ RunTime:0.1800s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000098s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000185s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.396425s ]
INFO: [ view_parse ] --END-- [ RunTime:0.396496s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000285s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000316s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000656s ]
INFO: [ app_end ] --END-- [ RunTime:0.000728s ]

[ 2017-03-15T22:11:56+08:00 ] 183.232.228.22 /Admin.php/Blog/article/p/4.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.046628s ]
INFO: [ app_init ] --END-- [ RunTime:0.046988s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000469s ]
INFO: [ app_begin ] --END-- [ RunTime:0.043604s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0264s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0266s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0262s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 30,10   [ RunTime:0.1321s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000104s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000175s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.402431s ]
INFO: [ view_parse ] --END-- [ RunTime:0.402504s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000289s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000327s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000773s ]
INFO: [ app_end ] --END-- [ RunTime:0.000864s ]

[ 2017-03-15T22:12:10+08:00 ] 183.232.228.22 /Admin.php/Blog/article/p/3.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.035532s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.046602s ]
INFO: [ app_begin ] --END-- [ RunTime:0.046662s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0249s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0253s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0344s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 20,10   [ RunTime:0.2490s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000098s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000184s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.487563s ]
INFO: [ view_parse ] --END-- [ RunTime:0.487667s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.042413s ]
INFO: [ view_filter ] --END-- [ RunTime:0.042486s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000648s ]
INFO: [ app_end ] --END-- [ RunTime:0.000729s ]

[ 2017-03-15T22:12:16+08:00 ] 183.232.228.22 /Admin.php/Blog/article/p/2.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000020s ]
INFO: [ app_init ] --END-- [ RunTime:0.000438s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.043673s ]
INFO: [ app_begin ] --END-- [ RunTime:0.043766s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0252s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0251s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0247s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 10,10   [ RunTime:0.1734s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000101s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000205s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.408292s ]
INFO: [ view_parse ] --END-- [ RunTime:0.408376s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000252s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000283s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000631s ]
INFO: [ app_end ] --END-- [ RunTime:0.006400s ]

[ 2017-03-15T22:12:22+08:00 ] 183.232.228.22 /Admin.php/Blog/article/p/4.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.049593s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.043620s ]
INFO: [ app_begin ] --END-- [ RunTime:0.043691s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0274s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0263s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0261s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 30,10   [ RunTime:0.1314s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000110s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000180s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.337559s ]
INFO: [ view_parse ] --END-- [ RunTime:0.337635s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000214s ]
INFO: [ view_filter ] --END-- [ RunTime:0.044317s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000701s ]
INFO: [ app_end ] --END-- [ RunTime:0.000775s ]

[ 2017-03-15T22:12:55+08:00 ] 183.232.228.22 /Admin.php/Blog/article.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.017393s ]
INFO: [ app_init ] --END-- [ RunTime:0.048534s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000675s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012837s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0253s ]
SQL: SHOW COLUMNS FROM `bk_article` [ RunTime:0.0251s ]
SQL: SELECT COUNT(*) AS tp_count FROM `bk_article` LIMIT 1   [ RunTime:0.0248s ]
SQL: SELECT a.*,c.name,c.english FROM bk_article a left join bk_category c on a.cate_id=c.cate_id  LIMIT 0,10   [ RunTime:0.1744s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000103s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000188s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.356517s ]
INFO: [ view_parse ] --END-- [ RunTime:0.356602s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000293s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000342s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000752s ]
INFO: [ app_end ] --END-- [ RunTime:0.000842s ]

